!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("jon-trombone",[],e):"object"==typeof exports?exports["jon-trombone"]=e():t["jon-trombone"]=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist",n(n.s=82)}([function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";e.__esModule=!0;var i,r=n(80),o=(i=r)&&i.__esModule?i:{default:i};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,o.default)(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()},function(t,e,n){var i=n(23)("wks"),r=n(15),o=n(4).Symbol,s="function"==typeof o;(t.exports=function(t){return i[t]||(i[t]=s&&o[t]||(s?o:r)("Symbol."+t))}).store=i},function(t,e){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){(function(t){var n={};!function(t){var e=t.DEFAULT_VOLUME=90,n=(t.DEFAULT_DURATION=128,t.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(t){var e=/([a-g])(#+|b+)?([0-9]+)$/i.exec(t),i=e[1].toLowerCase(),r=e[2]||"";return 12*parseInt(e[3],10)+n.midi_letter_pitches[i]+("#"==r.substr(0,1)?1:-1)*r.length},ensureMidiPitch:function(t){return"number"!=typeof t&&/[^0-9]/.test(t)?n.midiPitchFromNote(t):parseInt(t,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(t,e){var i,r=0,o=t;e=e||!1;return t>23&&(o=t-12*(r=Math.floor(t/12)-1)),i=n.midi_pitches_letter[o],e&&i.indexOf("#")>0&&(i=n.midi_flattened_notes[i]),i+r},mpqnFromBpm:function(t){var e=Math.floor(6e7/t),n=[];do{n.unshift(255&e),e>>=8}while(e);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(t){if(void 0!==t[0]){0;for(var e=0,n=t.length-1;n>=0;++e,--n)t[e]<<n}return Math.floor(6e7/t)},codes2Str:function(t){return String.fromCharCode.apply(null,t)},str2Bytes:function(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],i=t.length-1;i>=0;i-=2){var r=0===i?t[i]:t[i-1]+t[i];n.unshift(parseInt(r,16))}return n},translateTickTime:function(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];n.push(255&e),128&e;)e>>=8;return n}}),i=function(t){if(!this)return new i(t);!t||null===t.type&&void 0===t.type||null===t.channel&&void 0===t.channel||null===t.param1&&void 0===t.param1||(this.setTime(t.time),this.setType(t.type),this.setChannel(t.channel),this.setParam1(t.param1),this.setParam2(t.param2))};i.NOTE_OFF=128,i.NOTE_ON=144,i.AFTER_TOUCH=160,i.CONTROLLER=176,i.PROGRAM_CHANGE=192,i.CHANNEL_AFTERTOUCH=208,i.PITCH_BEND=224,i.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},i.prototype.setType=function(t){if(t<i.NOTE_OFF||t>i.PITCH_BEND)throw new Error("Trying to set an unknown event: "+t);this.type=t},i.prototype.setChannel=function(t){if(t<0||t>15)throw new Error("Channel is out of bounds.");this.channel=t},i.prototype.setParam1=function(t){this.param1=t},i.prototype.setParam2=function(t){this.param2=t},i.prototype.toBytes=function(){var t=[],e=this.type|15&this.channel;return t.push.apply(t,this.time),t.push(e),t.push(this.param1),void 0!==this.param2&&null!==this.param2&&t.push(this.param2),t};var r=function(t){if(!this)return new r(t);this.setTime(t.time),this.setType(t.type),this.setData(t.data)};r.SEQUENCE=0,r.TEXT=1,r.COPYRIGHT=2,r.TRACK_NAME=3,r.INSTRUMENT=4,r.LYRIC=5,r.MARKER=6,r.CUE_POINT=7,r.CHANNEL_PREFIX=32,r.END_OF_TRACK=47,r.TEMPO=81,r.SMPTE=84,r.TIME_SIG=88,r.KEY_SIG=89,r.SEQ_EVENT=127,r.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},r.prototype.setType=function(t){this.type=t},r.prototype.setData=function(t){this.data=t},r.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var t=[];if(t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data))t.push(this.data.length),t.push.apply(t,this.data);else if("number"==typeof this.data)t.push(1,this.data);else if(null!==this.data&&void 0!==this.data){t.push(this.data.length);var e=this.data.split("").map(function(t){return t.charCodeAt(0)});t.push.apply(t,e)}else t.push(0);return t};var o=function(t){if(!this)return new o(t);var e=t||{};this.events=e.events||[]};o.START_BYTES=[77,84,114,107],o.END_BYTES=[0,255,47,0],o.prototype.addEvent=function(t){return this.events.push(t),this},o.prototype.addNoteOn=o.prototype.noteOn=function(t,r,o,s){return this.events.push(new i({type:i.NOTE_ON,channel:t,param1:n.ensureMidiPitch(r),param2:s||e,time:o||0})),this},o.prototype.addNoteOff=o.prototype.noteOff=function(t,r,o,s){return this.events.push(new i({type:i.NOTE_OFF,channel:t,param1:n.ensureMidiPitch(r),param2:s||e,time:o||0})),this},o.prototype.addNote=o.prototype.note=function(t,e,n,i,r){return this.noteOn(t,e,i,r),n&&this.noteOff(t,e,n,r),this},o.prototype.addChord=o.prototype.chord=function(t,e,n,i){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach(function(e){this.noteOn(t,e,0,i)},this),e.forEach(function(e,i){0===i?this.noteOff(t,e,n):this.noteOff(t,e)},this),this},o.prototype.setInstrument=o.prototype.instrument=function(t,e,n){return this.events.push(new i({type:i.PROGRAM_CHANGE,channel:t,param1:e,time:n||0})),this},o.prototype.setTempo=o.prototype.tempo=function(t,e){return this.events.push(new r({type:r.TEMPO,data:n.mpqnFromBpm(t),time:e||0})),this},o.prototype.toBytes=function(){var t=0,e=[],i=o.START_BYTES,r=o.END_BYTES;this.events.forEach(function(n){var i=n.toBytes();t+=i.length,e.push.apply(e,i)}),t+=r.length;var s=n.str2Bytes(t.toString(16),4);return i.concat(s,e,r)};var s=function(t){if(!this)return new s(t);var e=t||{};if(e.ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||e.ticks>=32768||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]};s.HDR_CHUNKID="MThd",s.HDR_CHUNK_SIZE="\0\0\0",s.HDR_TYPE0="\0\0",s.HDR_TYPE1="\0",s.prototype.addTrack=function(t){return t?(this.tracks.push(t),this):(t=new o,this.tracks.push(t),t)},s.prototype.toBytes=function(){var t=this.tracks.length.toString(16),e=s.HDR_CHUNKID+s.HDR_CHUNK_SIZE;return parseInt(t,16)>1?e+=s.HDR_TYPE1:e+=s.HDR_TYPE0,e+=n.codes2Str(n.str2Bytes(t,2)),e+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach(function(t){e+=n.codes2Str(t.toBytes())}),e},t.Util=n,t.File=s,t.Track=o,t.Event=i,t.MetaEvent=r}(n),void 0!==t&&null!==t?t.exports=n:void 0!==e&&null!==e?e=n:this.Midi=n}).call(this,n(32)(t))},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){t.exports=!n(13)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var i=n(14),r=n(75),o=n(74),s=Object.defineProperty;e.f=n(7)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var i=n(9),r=n(26);t.exports=n(7)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e){t.exports={}},function(t,e,n){t.exports={default:n(72),__esModule:!0}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var i=n(8);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){var i=n(23)("keys"),r=n(15);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){var i=n(67),r=n(18);t.exports=function(t){return i(r(t))}},function(t,e,n){var i=n(4),r=n(3),o=n(77),s=n(10),a=function(t,e,n){var u,h,c,l=t&a.F,f=t&a.G,d=t&a.S,p=t&a.P,m=t&a.B,v=t&a.W,y=f?r:r[e]||(r[e]={}),g=y.prototype,b=f?i:d?i[e]:(i[e]||{}).prototype;for(u in f&&(n=e),n)(h=!l&&b&&void 0!==b[u])&&u in y||(c=h?b[u]:n[u],y[u]=f&&"function"!=typeof b[u]?n[u]:m&&h?o(c,i):v&&b[u]==c?function(t){var e=function(e,n,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,i)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):p&&"function"==typeof c?o(Function.call,c):c,p&&((y.virtual||(y.virtual={}))[u]=c,t&a.R&&g&&!g[u]&&s(g,u,c)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,e,n){var i=n(9).f,r=n(6),o=n(2)("toStringTag");t.exports=function(t,e,n){t&&!r(t=n?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var i=n(4),r=i["__core-js_shared__"]||(i["__core-js_shared__"]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e,n){"use strict";var i=n(66),r=n(20),o=n(65),s=n(10),a=n(6),u=n(11),h=n(64),c=n(21),l=n(55),f=n(2)("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,n,m,v,y,g){h(n,e,m);var b,w,T,x=function(t){if(!d&&t in O)return O[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},k=e+" Iterator",M="values"==v,S=!1,O=t.prototype,E=O[f]||O["@@iterator"]||v&&O[v],_=!d&&E||x(v),L=v?M?x("entries"):_:void 0,R="Array"==e&&O.entries||E;if(R&&(T=l(R.call(new t)))!==Object.prototype&&T.next&&(c(T,k,!0),i||a(T,f)||s(T,f,p)),M&&E&&"values"!==E.name&&(S=!0,_=function(){return E.call(this)}),i&&!g||!d&&!S&&O[f]||s(O,f,_),u[e]=_,u[k]=p,v)if(b={values:M?_:x("values"),keys:y?_:x("keys"),entries:L},g)for(w in b)w in O||o(O,w,b[w]);else r(r.P+r.F*(d||S),e,b);return b}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var i=n(8),r=n(4).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e){function n(t){var e=0;function n(n){var i=t.charCodeAt(e);return n&&i>127&&(i-=256),e+=1,i}return{eof:function(){return e>=t.length},read:function(n){var i=t.substr(e,n);return e+=n,i},readInt32:function(){var n=(t.charCodeAt(e)<<24)+(t.charCodeAt(e+1)<<16)+(t.charCodeAt(e+2)<<8)+t.charCodeAt(e+3);return e+=4,n},readInt16:function(){var n=(t.charCodeAt(e)<<8)+t.charCodeAt(e+1);return e+=2,n},readInt8:n,readVarInt:function(){for(var t=0;;){var e=n();if(!(128&e))return t+e;t+=127&e,t<<=7}}}}t.exports=function(t){return function(t){function e(t){var e=t.read(4),n=t.readInt32();return{id:e,length:n,data:t.read(n)}}var i;function r(t){var e={};e.deltaTime=t.readVarInt();var n,r=t.readInt8();if(240==(240&r)){if(255==r){e.type="meta";var o=t.readInt8(),s=t.readVarInt();switch(o){case 0:if(e.subtype="sequenceNumber",2!=s)throw"Expected length for sequenceNumber event is 2, got "+s;return e.number=t.readInt16(),e;case 1:return e.subtype="text",e.text=t.read(s),e;case 2:return e.subtype="copyrightNotice",e.text=t.read(s),e;case 3:return e.subtype="trackName",e.text=t.read(s),e;case 4:return e.subtype="instrumentName",e.text=t.read(s),e;case 5:return e.subtype="lyrics",e.text=t.read(s),e;case 6:return e.subtype="marker",e.text=t.read(s),e;case 7:return e.subtype="cuePoint",e.text=t.read(s),e;case 32:if(e.subtype="midiChannelPrefix",1!=s)throw"Expected length for midiChannelPrefix event is 1, got "+s;return e.channel=t.readInt8(),e;case 47:if(e.subtype="endOfTrack",0!=s)throw"Expected length for endOfTrack event is 0, got "+s;return e;case 81:if(e.subtype="setTempo",3!=s)throw"Expected length for setTempo event is 3, got "+s;return e.microsecondsPerBeat=(t.readInt8()<<16)+(t.readInt8()<<8)+t.readInt8(),e;case 84:if(e.subtype="smpteOffset",5!=s)throw"Expected length for smpteOffset event is 5, got "+s;var a=t.readInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&a],e.hour=31&a,e.min=t.readInt8(),e.sec=t.readInt8(),e.frame=t.readInt8(),e.subframe=t.readInt8(),e;case 88:if(e.subtype="timeSignature",4!=s)throw"Expected length for timeSignature event is 4, got "+s;return e.numerator=t.readInt8(),e.denominator=Math.pow(2,t.readInt8()),e.metronome=t.readInt8(),e.thirtyseconds=t.readInt8(),e;case 89:if(e.subtype="keySignature",2!=s)throw"Expected length for keySignature event is 2, got "+s;return e.key=t.readInt8(!0),e.scale=t.readInt8(),e;case 127:return e.subtype="sequencerSpecific",e.data=t.read(s),e;default:return e.subtype="unknown",e.data=t.read(s),e}return e.data=t.read(s),e}if(240==r){e.type="sysEx";var s=t.readVarInt();return e.data=t.read(s),e}if(247==r){e.type="dividedSysEx";var s=t.readVarInt();return e.data=t.read(s),e}throw"Unrecognised MIDI event type byte: "+r}0==(128&r)?(n=r,r=i):(n=t.readInt8(),i=r);var u=r>>4;switch(e.channel=15&r,e.type="channel",u){case 8:return e.subtype="noteOff",e.noteNumber=n,e.velocity=t.readInt8(),e;case 9:return e.noteNumber=n,e.velocity=t.readInt8(),0==e.velocity?e.subtype="noteOff":e.subtype="noteOn",e;case 10:return e.subtype="noteAftertouch",e.noteNumber=n,e.amount=t.readInt8(),e;case 11:return e.subtype="controller",e.controllerType=n,e.value=t.readInt8(),e;case 12:return e.subtype="programChange",e.programNumber=n,e;case 13:return e.subtype="channelAftertouch",e.amount=n,e;case 14:return e.subtype="pitchBend",e.value=n+(t.readInt8()<<7),e;default:throw"Unrecognised MIDI event type: "+u}}stream=n(t);var o=e(stream);if("MThd"!=o.id||6!=o.length)throw"Bad .mid file - header not found";var s=n(o.data),a=s.readInt16(),u=s.readInt16(),h=s.readInt16();if(32768&h)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=h;for(var c={formatType:a,trackCount:u,ticksPerBeat:ticksPerBeat},l=[],f=0;f<c.trackCount;f++){l[f]=[];var d=e(stream);if("MTrk"!=d.id)throw"Unexpected chunk - expected MTrk, got "+d.id;for(var p=n(d.data);!p.eof();){var m=r(p);l[f].push(m)}}return{header:c,tracks:l}}(t)}},function(t,e,n){"use strict";n.r(e);var i=n(28),r=n(5);function o(t){return"number"==typeof t}const s=function(){const t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;return e=>"string"==typeof e&&t.test(e)}();const a=function(){const t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return n=>{const i=t.exec(n),r=i[1],o=i[2];return e[r.toLowerCase()]+12*(parseInt(o)+1)}}();function u(t,e){if(t.length){const n=function(t,e){let n=0;const i=t.length;let r=i;if(i>0&&t[i-1].time<=e)return i-1;for(;n<r;){let i=Math.floor(n+(r-n)/2);const o=t[i],s=t[i+1];if(o.time===e){for(let n=i;n<t.length;n++)t[n].time===e&&(i=n);return i}if(o.time<e&&s.time>e)return i;o.time>e?r=i:o.time<e&&(n=i+1)}return-1}(t,e.time);t.splice(n+1,0,e)}else t.push(e)}const h={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"};class c{constructor(t,e,n){this.number=t,this.time=e,this.value=n}get name(){if(h.hasOwnProperty(this.number))return h[this.number]}}function l(t,e){for(let n=0;n<t.length;n++){let i=t[n],r=e[n];if(i.length>r)return!0}return!1}function f(t,e,n){let i=0,r=1/0;for(let n=0;n<t.length;n++){let o=t[n],s=e[n];o[s]&&o[s].time<r&&(i=n,r=o[s].time)}n[i](t[i][e[i]]),e[i]+=1}class d{static fromJSON(t){return new d(t.midi,t.time,t.duration,t.velocity)}constructor(t,e,n=0,i=1){if(o(t))this.midi=t;else{if(!s(t))throw new Error("the midi value must either be in Pitch Notation (e.g. C#4) or a midi value");this.name=t}this.time=e,this.duration=n,this.velocity=i}match(t){return o(t)?this.midi===t:s(t)?this.name.toLowerCase()===t.toLowerCase():void 0}get name(){return function(t){const e=Math.floor(t/12)-1;return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]+e}(this.midi)}set name(t){this.midi=a(t)}get noteOn(){return this.time}set noteOn(t){this.time=t}get noteOff(){return this.time+this.duration}set noteOff(t){this.duration=t-this.time}toJSON(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration}}}const p=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],m=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"],v={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"};class y{static fromJSON(t){var e=new y(t.name,t.instrumentNumber,t.channelNumber);return e.id=t.id,t.notes&&t.notes.forEach(t=>{var n=d.fromJSON(t);e.notes.push(n)}),t.controlChanges&&(e.controlChanges=t.controlChanges),e}constructor(t,e=-1,n=-1){this.name=t,this.channelNumber=n,this.notes=[],this.controlChanges={},this.instrumentNumber=e}note(t,e,n=0,i=1){const r=new d(t,e,n,i);return u(this.notes,r),this}noteOn(t,e,n=1){const i=new d(t,e,0,n);return u(this.notes,i),this}noteOff(t,e){for(let n=0;n<this.notes.length;n++){let i=this.notes[n];if(i.match(t)&&0===i.duration){i.noteOff=e;break}}return this}cc(t,e,n){this.controlChanges.hasOwnProperty(t)||(this.controlChanges[t]=[]);const i=new c(t,e,n);return u(this.controlChanges[t],i),this}patch(t){return this.instrumentNumber=t,this}channel(t){return this.channelNumber=t,this}get noteOns(){const t=[];return this.notes.forEach(e=>{t.push({time:e.noteOn,midi:e.midi,name:e.name,velocity:e.velocity})}),t}get noteOffs(){const t=[];return this.notes.forEach(e=>{t.push({time:e.noteOff,midi:e.midi,name:e.name})}),t}get length(){return this.notes.length}get startTime(){if(this.notes.length){return this.notes[0].noteOn}return 0}get duration(){if(this.notes.length){return this.notes[this.notes.length-1].noteOff}return 0}get instrument(){return this.isPercussion?v[this.instrumentNumber]:p[this.instrumentNumber]}set instrument(t){const e=p.indexOf(t);-1!==e&&(this.instrumentNumber=e)}get isPercussion(){return[9,10].includes(this.channelNumber)}get instrumentFamily(){return this.isPercussion?"drums":m[Math.floor(this.instrumentNumber/8)]}scale(t){return this.notes.forEach(e=>{e.time*=t,e.duration*=t}),this}slice(t=0,e=this.duration){const n=Math.max(this.notes.findIndex(e=>e.time>=t),0),i=this.notes.findIndex(t=>t.noteOff>=e)+1,r=new y(this.name);return r.notes=this.notes.slice(n,i),r.notes.forEach(e=>e.time=e.time-t),r}encode(t,e){const n=e.PPQ/(60/e.bpm);let i=0;const r=Math.max(0,this.channelNumber);function o(t){const e=Math.floor(n*t),r=Math.max(e-i,0);return i=e,r}-1!==this.instrumentNumber&&t.instrument(r,this.instrumentNumber),function(...t){const e=t.filter((t,e)=>e%2==0),n=new Uint32Array(e.length),i=t.filter((t,e)=>e%2==1);for(;l(e,n);)f(e,n,i)}(this.noteOns,e=>{t.addNoteOn(r,e.name,o(e.time),Math.floor(127*e.velocity))},this.noteOffs,e=>{t.addNoteOff(r,e.name,o(e.time))})}toJSON(){const t={startTime:this.startTime,duration:this.duration,length:this.length,notes:[],controlChanges:{}};return void 0!==this.id&&(t.id=this.id),t.name=this.name,-1!==this.instrumentNumber&&(t.instrumentNumber=this.instrumentNumber,t.instrument=this.instrument,t.instrumentFamily=this.instrumentFamily),-1!==this.channelNumber&&(t.channelNumber=this.channelNumber,t.isPercussion=this.isPercussion),this.notes.length&&(t.notes=this.notes.map(t=>t.toJSON())),Object.keys(this.controlChanges).length&&(t.controlChanges=this.controlChanges),t}}class g{static fromJSON(t){var e=new g;return e.header=t.header,t.tracks.forEach(t=>{var n=y.fromJSON(t);e.tracks.push(n)}),e}constructor(){this.header={bpm:120,timeSignature:[4,4],PPQ:480},this.tracks=[]}load(t,e=null,n="GET"){return new Promise((i,r)=>{var o=new XMLHttpRequest;o.open(n,t),o.responseType="arraybuffer",o.addEventListener("load",()=>{4===o.readyState&&200===o.status?i(this.decode(o.response)):r(o.status)}),o.addEventListener("error",r),o.send(e)}).catch(function(t){console.log(t)})}decode(t){if(t instanceof ArrayBuffer){var e=new Uint8Array(t);t=String.fromCharCode.apply(null,e)}const n=i(t);var r,o;return this.header=function(t){for(var e={PPQ:t.header.ticksPerBeat},n=0;n<t.tracks.length;n++)for(var i=t.tracks[n],r=0;r<i.length;r++){var o=i[r];"meta"===o.type&&("timeSignature"===o.subtype?e.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(e.bpm||(e.bpm=6e7/o.microsecondsPerBeat)))}return e.bpm=e.bpm||120,e}(n),this.tracks=[],n.tracks.forEach((t,e)=>{const n=new y;n.id=e,this.tracks.push(n);let i=0;t.forEach(t=>{i+=(r=t.deltaTime,60/(o=this.header).bpm*(r/o.PPQ)),"meta"===t.type&&"trackName"===t.subtype?n.name=t.text.replace(/\u0000/g,""):"noteOn"===t.subtype?(n.noteOn(t.noteNumber,i,t.velocity/127),-1===n.channelNumber&&(n.channelNumber=t.channel)):"noteOff"===t.subtype?n.noteOff(t.noteNumber,i):"controller"===t.subtype&&t.controllerType?n.cc(t.controllerType,i,t.value/127):"meta"===t.type&&"instrumentName"===t.subtype?n.instrument=t.text:"channel"===t.type&&"programChange"===t.subtype&&(n.patch(t.programNumber),n.channelNumber=t.channel)}),this.header.name||n.length||!n.name||(this.header.name=n.name)}),this}encode(){const t=new r.File({ticks:this.header.PPQ}),e=this.tracks.filter(t=>!t.length)[0];if(this.header.name&&(!e||e.name!==this.header.name)){t.addTrack().addEvent(new r.MetaEvent({time:0,type:r.MetaEvent.TRACK_NAME,data:this.header.name}))}return this.tracks.forEach(e=>{const n=t.addTrack();n.setTempo(this.bpm),e.name&&n.addEvent(new r.MetaEvent({time:0,type:r.MetaEvent.TRACK_NAME,data:e.name})),e.encode(n,this.header)}),t.toBytes()}toArray(){const t=this.encode(),e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}toJSON(){const t={header:this.header,startTime:this.startTime,duration:this.duration,tracks:(this.tracks||[]).map(t=>t.toJSON())};return t.header.name||(t.header.name=""),t}track(t){const e=new y(t);return this.tracks.push(e),e}get(t){return o(t)?this.tracks[t]:this.tracks.find(e=>e.name===t)}slice(t=0,e=this.duration){const n=new g;return n.header=this.header,n.tracks=this.tracks.map(n=>n.slice(t,e)),n}get startTime(){const t=this.tracks.map(t=>t.startTime);return t.length&&Math.min.apply(Math,t)||0}get bpm(){return this.header.bpm}set bpm(t){const e=this.header.bpm;this.header.bpm=t;const n=e/t;this.tracks.forEach(t=>t.scale(n))}get timeSignature(){return this.header.timeSignature}set timeSignature(t){this.header.timeSignature=t}get duration(){const t=this.tracks.map(t=>t.duration);return t.length&&Math.max.apply(Math,t)||0}}function b(t){return(new g).decode(t)}function w(t,e){const n=(new g).load(t);return e&&n.then(e),n}function T(){return new g}function x(t){return g.fromJSON(t)}n.d(e,"parse",function(){return b}),n.d(e,"load",function(){return w}),n.d(e,"create",function(){return T}),n.d(e,"fromJSON",function(){return x}),n.d(e,"instrumentByPatchID",function(){return p}),n.d(e,"instrumentFamilyByID",function(){return m}),n.d(e,"drumKitByPatchID",function(){return v})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gui=void 0;var i=o(n(0)),r=o(n(1));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(){(0,i.default)(this,t)}return(0,r.default)(t,[{key:"Init",value:function(t,e){guify?(this.panel=new guify({title:"Jon-Trombone",theme:"dark",root:e,width:350,barMode:"above",align:"right",opacity:"0.95"}),this.panel.Register({type:"checkbox",label:"Mute",object:t.trombone,property:"muted",onChange:function(e){t.trombone.SetMute(e)}}),this.panel.Register({type:"folder",label:"Jon"}),this.panel.Register([{type:"checkbox",label:"Move Jaw",object:t,property:"moveJaw"},{type:"range",label:"Jaw Speed",object:t,property:"jawFlapSpeed",min:0,max:100},{type:"range",label:"Jaw Range",object:t,property:"jawOpenOffset",min:0,max:1}],{folder:"Jon"}),this.panel.Register({type:"folder",label:"Voice"}),this.panel.Register([{type:"checkbox",label:"Wobble",object:t.trombone,property:"autoWobble"},{type:"checkbox",label:"Pitch Variance",object:t.trombone.voices[0].glottis,property:"addPitchVariance"},{type:"checkbox",label:"Tenseness Variance",object:t.trombone.voices[0].glottis,property:"addTensenessVariance"},{type:"range",label:"Tenseness",object:t.trombone.voices[0].glottis,property:"UITenseness",min:0,max:1},{type:"range",label:"Vibrato",object:t.trombone.voices[0].glottis,property:"vibratoAmount",min:0,max:.5},{type:"range",label:"Frequency",object:t.trombone.voices[0].glottis,property:"UIFrequency",min:1,max:1e3,step:1},{type:"range",label:"Loudness",object:t.trombone.voices[0].glottis,property:"loudness",min:0,max:1}],{folder:"Voice"}),this.panel.Register({type:"folder",label:"Tract"}),this.panel.Register([{type:"range",label:"Move Speed",object:t.trombone.voices[0].tract,property:"movementSpeed",min:1,max:30,step:1},{type:"range",label:"Velum Target",object:t.trombone.voices[0].tract,property:"velumTarget",min:.001,max:2},{type:"range",label:"Target",object:t.trombone.voices[0].tractUI,property:"target",min:.001,max:1},{type:"range",label:"Index",object:t.trombone.voices[0].tractUI,property:"index",min:0,max:43,step:1},{type:"range",label:"Radius",object:t.trombone.voices[0].tractUI,property:"radius",min:0,max:5,step:1}],{folder:"Tract"}),this.panel.Register({type:"folder",label:"MIDI"}),this.panel.Register([{type:"file",label:"MIDI File",fileReadFunc:"readAsBinaryString",onChange:function(e){t.midiController.LoadSongDirect(e)}},{type:"title",label:"Controls"},{type:"button",label:"Play",action:function(){return t.midiController.PlaySong()}},{type:"button",label:"Stop",action:function(){return t.midiController.Stop()}},{type:"button",label:"Restart",action:function(){return t.midiController.Restart()}},{type:"title",label:"Options"},{type:"range",label:"Track",object:t.midiController,property:"currentTrack",min:1,max:20,step:1},{type:"range",label:"Base Frequency",object:t.midiController,property:"baseFreq",min:1,max:2e3,step:1},{type:"checkbox",label:"Extreme Vibrato",object:t,property:"flapWhileSinging"},{type:"checkbox",label:"Legato",object:t,property:"legato"}],{folder:"MIDI"})):console.log("Guify was not found! Add it to your page to enable a GUI for this program.")}}]),t}();e.gui=new s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TTSController=void 0;var i,r=n(0),o=(i=r)&&i.__esModule?i:{default:i};e.TTSController=function t(){(0,o.default)(this,t)}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MidiController=void 0;var i=s(n(12)),r=s(n(0)),o=s(n(1));function s(t){return t&&t.__esModule?t:{default:t}}var a=n(29),u=function(){function t(e){(0,r.default)(this,t),this.controller=e,this.midi=null,this.playing=!1,this.currentTrack=5,this.baseFreq=440,this.clock=new THREE.Clock(!1)}return(0,o.default)(t,[{key:"LoadSong",value:function(t,e){var n=this;this.Stop(),this.midi=null,a.load(t,function(t){console.log("MIDI loaded."),n.midi=t,console.log(n.midi),e&&e(t)})}},{key:"LoadSongDirect",value:function(t){this.Stop(),this.midi=a.parse(t),console.log("MIDI loaded."),console.log(this.midi)}},{key:"GetPitch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTrack,e=this.GetSongProgress();return t=Math.min(t,this.midi.tracks.length-1),t=Math.max(t,0),this.midi.tracks[t].notes.find(function(t){return t.noteOn<=e&&e<=t.noteOff})}},{key:"GetPitches",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTrack,e=this.GetSongProgress();return t=Math.min(t,this.midi.tracks.length-1),t=Math.max(t,0),this.midi.tracks[t].notes.filter(function(t){return t.noteOn<=e&&e<=t.noteOff})}},{key:"PlaySong",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;if(!this.playing){if(!this.midi)return console.log("No MIDI is loaded. Loading an example..."),void this.LoadSong("../resources/midi/un-owen-was-her.mid",function(){t.PlaySong()});this.EnterSingMode(),this.currentTrack=e,this.clock.start(),this.playing=!0,console.log("Playback started.")}}},{key:"GetSongProgress",value:function(){return this.clock.getElapsedTime()}},{key:"MIDIToFrequency",value:function(t){return this.baseFreq*Math.pow(2,(t-69)/12)}},{key:"Restart",value:function(){console.log("Playback moved to beginning."),this.clock=new THREE.Clock}},{key:"Stop",value:function(){this.playing&&(console.log("Playback stopped."),this.clock.stop(),this.playing=!1,this.ExitSingMode())}},{key:"EnterSingMode",value:function(){if(!this.backup_settings){this.backup_settings={},this.backup_settings.autoWobble=this.controller.trombone.autoWobble,this.controller.trombone.autoWobble=!1;var t=!0,e=!1,n=void 0;try{for(var r,o=(0,i.default)(this.controller.trombone.voices);!(t=(r=o.next()).done);t=!0){var s=r.value,a={};a.addPitchVariance=s.glottis.addPitchVariance,s.glottis.addPitchVariance=!1,a.addTensenessVariance=s.glottis.addTensenessVariance,s.glottis.addTensenessVariance=!1,a.vibratoFrequency=s.glottis.vibratoFrequency,s.glottis.vibratoFrequency=0,a.frequency=s.glottis.UIFrequency,a.loudness=s.glottis.loudness,s.glottis.loudness=0,this.backup_settings[""+s.id]=a}}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}}}},{key:"ExitSingMode",value:function(){if(this.backup_settings){this.controller.trombone.autoWobble=this.backup_settings.autoWobble;var t=!0,e=!1,n=void 0;try{for(var r,o=(0,i.default)(this.controller.trombone.voices);!(t=(r=o.next()).done);t=!0){var s=r.value,a=this.backup_settings[""+s.id];s.glottis.addPitchVariance=a.addPitchVariance,s.glottis.addTensenessVariance=a.addTensenessVariance,s.glottis.vibratoFrequency=a.vibratoFrequency,s.glottis.UIFrequency=a.frequency,s.glottis.loudness=a.loudness}}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}this.backup_settings=null}}}]),t}();e.MidiController=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TractUI=void 0;var i=o(n(0)),r=o(n(1));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e,n){(0,i.default)(this,t),this.trombone=e,this.tract=n,this.originX=340,this.originY=449,this.radius=298,this.scale=60,this.tongueIndex=12.9,this.tongueDiameter=2.43,this.innerTongueControlRadius=2.05,this.outerTongueControlRadius=3.5,this.tongueTouch=0,this.angleScale=.64,this.angleOffset=-.24,this.noseOffset=.8,this.gridOffset=1.7,this.target=.1,this.index=42,this.radius=0}return(0,r.default)(t,[{key:"init",value:function(){var t=this.tract;this.setRestDiameter();for(var e=0;e<t.n;e++)t.diameter[e]=t.targetDiameter[e]=t.restDiameter[e];this.tongueLowerIndexBound=t.bladeStart+2,this.tongueUpperIndexBound=t.tipStart-3,this.tongueIndexCentre=.5*(this.tongueLowerIndexBound+this.tongueUpperIndexBound)}},{key:"getIndex",value:function(t,e){for(var n=this.tract,i=t-this.originX,r=e-this.originY,o=Math.atan2(r,i);o>0;)o-=2*Math.PI;return(Math.PI+o-this.angleOffset)*(n.lipStart-1)/(this.angleScale*Math.PI)}},{key:"getDiameter",value:function(t,e){var n=t-this.originX,i=e-this.originY;return(this.radius-Math.sqrt(n*n+i*i))/this.scale}},{key:"setRestDiameter",value:function(){for(var t=this.tract,e=t.bladeStart;e<t.lipStart;e++){var n=1.1*Math.PI*(this.tongueIndex-e)/(t.tipStart-t.bladeStart),i=(1.5-(2+(this.tongueDiameter-2)/1.5)+this.gridOffset)*Math.cos(n);e!=t.bladeStart-2&&e!=t.lipStart-1||(i*=.8),e!=t.bladeStart&&e!=t.lipStart-2||(i*=.94),t.restDiameter[e]=1.5-i}}},{key:"SetLipsClosed",value:function(t){var e=this.tract;this.setRestDiameter();for(var n=0;n<e.n;n++)e.targetDiameter[n]=e.restDiameter[n];for(var i=this.index-this.radius;i<=this.index+this.radius;i++)if(!(i>e.targetDiameter.length||i<0)){var r=Math.lerp(e.restDiameter[i],this.target,t);e.targetDiameter[i]=r}}}]),t}();e.TractUI=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tract=void 0;var i=o(n(0)),r=o(n(1));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(e,n){(0,i.default)(this,t),this.trombone=e,this.glottis=n,this.n=44,this.bladeStart=10,this.tipStart=32,this.lipStart=39,this.R=[],this.L=[],this.reflection=[],this.junctionOutputR=[],this.junctionOutputL=[],this.maxAmplitude=[],this.diameter=[],this.restDiameter=[],this.targetDiameter=[],this.newDiameter=[],this.A=[],this.glottalReflection=.75,this.lipReflection=-.85,this.lastObstruction=-1,this.fade=1,this.movementSpeed=15,this.transients=[],this.lipOutput=0,this.noseOutput=0,this.velumTarget=.01}return(0,r.default)(t,[{key:"init",value:function(){this.bladeStart=Math.floor(this.bladeStart*this.n/44),this.tipStart=Math.floor(this.tipStart*this.n/44),this.lipStart=Math.floor(this.lipStart*this.n/44),this.diameter=new Float64Array(this.n),this.restDiameter=new Float64Array(this.n),this.targetDiameter=new Float64Array(this.n),this.newDiameter=new Float64Array(this.n);for(var t=0;t<this.n;t++){var e=0;e=t<7*this.n/44-.5?.6:t<12*this.n/44?1.1:1.5,this.diameter[t]=this.restDiameter[t]=this.targetDiameter[t]=this.newDiameter[t]=e}this.R=new Float64Array(this.n),this.L=new Float64Array(this.n),this.reflection=new Float64Array(this.n+1),this.newReflection=new Float64Array(this.n+1),this.junctionOutputR=new Float64Array(this.n+1),this.junctionOutputL=new Float64Array(this.n+1),this.A=new Float64Array(this.n),this.maxAmplitude=new Float64Array(this.n),this.noseLength=Math.floor(28*this.n/44),this.noseStart=this.n-this.noseLength+1,this.noseR=new Float64Array(this.noseLength),this.noseL=new Float64Array(this.noseLength),this.noseJunctionOutputR=new Float64Array(this.noseLength+1),this.noseJunctionOutputL=new Float64Array(this.noseLength+1),this.noseReflection=new Float64Array(this.noseLength+1),this.noseDiameter=new Float64Array(this.noseLength),this.noseA=new Float64Array(this.noseLength),this.noseMaxAmplitude=new Float64Array(this.noseLength);for(t=0;t<this.noseLength;t++){var n=t/this.noseLength*2;e=n<1?.4+1.6*n:.5+1.5*(2-n),e=Math.min(e,1.9),this.noseDiameter[t]=e}this.newReflectionLeft=this.newReflectionRight=this.newReflectionNose=0,this.calculateReflections(),this.calculateNoseReflections(),this.noseDiameter[0]=this.velumTarget}},{key:"reshapeTract",value:function(t){for(var e=t*this.movementSpeed,n=-1,i=0;i<this.n;i++){var r,o=this.diameter[i],s=this.targetDiameter[i];o<=0&&(n=i),r=i<this.noseStart?.6:i>=this.tipStart?1:.6+.4*(i-this.noseStart)/(this.tipStart-this.noseStart),this.diameter[i]=Math.moveTowards(o,s,r*e,2*e)}this.lastObstruction>-1&&-1==n&&this.noseA[0]<.05&&this.addTransient(this.lastObstruction),this.lastObstruction=n,e=t*this.movementSpeed,this.noseDiameter[0]=Math.moveTowards(this.noseDiameter[0],this.velumTarget,.25*e,.1*e),this.noseA[0]=this.noseDiameter[0]*this.noseDiameter[0]}},{key:"calculateReflections",value:function(){for(var t=0;t<this.n;t++)this.A[t]=this.diameter[t]*this.diameter[t];for(t=1;t<this.n;t++)this.reflection[t]=this.newReflection[t],0==this.A[t]?this.newReflection[t]=.999:this.newReflection[t]=(this.A[t-1]-this.A[t])/(this.A[t-1]+this.A[t]);this.reflectionLeft=this.newReflectionLeft,this.reflectionRight=this.newReflectionRight,this.reflectionNose=this.newReflectionNose;var e=this.A[this.noseStart]+this.A[this.noseStart+1]+this.noseA[0];this.newReflectionLeft=(2*this.A[this.noseStart]-e)/e,this.newReflectionRight=(2*this.A[this.noseStart+1]-e)/e,this.newReflectionNose=(2*this.noseA[0]-e)/e}},{key:"calculateNoseReflections",value:function(){for(var t=0;t<this.noseLength;t++)this.noseA[t]=this.noseDiameter[t]*this.noseDiameter[t];for(t=1;t<this.noseLength;t++)this.noseReflection[t]=(this.noseA[t-1]-this.noseA[t])/(this.noseA[t-1]+this.noseA[t])}},{key:"runStep",value:function(t,e,n){var i=Math.random()<.1;this.processTransients(),this.addTurbulenceNoise(e),this.junctionOutputR[0]=this.L[0]*this.glottalReflection+t,this.junctionOutputL[this.n]=this.R[this.n-1]*this.lipReflection;for(var r=1;r<this.n;r++){var o=(s=this.reflection[r]*(1-n)+this.newReflection[r]*n)*(this.R[r-1]+this.L[r]);this.junctionOutputR[r]=this.R[r-1]-o,this.junctionOutputL[r]=this.L[r]+o}r=this.noseStart;var s=this.newReflectionLeft*(1-n)+this.reflectionLeft*n;this.junctionOutputL[r]=s*this.R[r-1]+(1+s)*(this.noseL[0]+this.L[r]),s=this.newReflectionRight*(1-n)+this.reflectionRight*n,this.junctionOutputR[r]=s*this.L[r]+(1+s)*(this.R[r-1]+this.noseL[0]),s=this.newReflectionNose*(1-n)+this.reflectionNose*n,this.noseJunctionOutputR[0]=s*this.noseL[0]+(1+s)*(this.L[r]+this.R[r-1]);for(r=0;r<this.n;r++){if(this.R[r]=.999*this.junctionOutputR[r],this.L[r]=.999*this.junctionOutputL[r+1],i)(a=Math.abs(this.R[r]+this.L[r]))>this.maxAmplitude[r]?this.maxAmplitude[r]=a:this.maxAmplitude[r]*=.999}this.lipOutput=this.R[this.n-1],this.noseJunctionOutputL[this.noseLength]=this.noseR[this.noseLength-1]*this.lipReflection;for(r=1;r<this.noseLength;r++){o=this.noseReflection[r]*(this.noseR[r-1]+this.noseL[r]);this.noseJunctionOutputR[r]=this.noseR[r-1]-o,this.noseJunctionOutputL[r]=this.noseL[r]+o}for(r=0;r<this.noseLength;r++){var a;if(this.noseR[r]=this.noseJunctionOutputR[r]*this.fade,this.noseL[r]=this.noseJunctionOutputL[r+1]*this.fade,i)(a=Math.abs(this.noseR[r]+this.noseL[r]))>this.noseMaxAmplitude[r]?this.noseMaxAmplitude[r]=a:this.noseMaxAmplitude[r]*=.999}this.noseOutput=this.noseR[this.noseLength-1]}},{key:"finishBlock",value:function(){this.reshapeTract(this.trombone.audioSystem.blockTime),this.calculateReflections()}},{key:"addTransient",value:function(t){var e={};e.position=t,e.timeAlive=0,e.lifeTime=.2,e.strength=.3,e.exponent=200,this.transients.push(e)}},{key:"processTransients",value:function(){for(var t=0;t<this.transients.length;t++){var e=(n=this.transients[t]).strength*Math.pow(2,-n.exponent*n.timeAlive);this.R[n.position]+=e/2,this.L[n.position]+=e/2,n.timeAlive+=1/(2*this.trombone.audioSystem.sampleRate)}for(t=this.transients.length-1;t>=0;t--){var n;(n=this.transients[t]).timeAlive>n.lifeTime&&this.transients.splice(t,1)}}},{key:"addTurbulenceNoise",value:function(t){}},{key:"addTurbulenceNoiseAtIndex",value:function(t,e,n){var i=Math.floor(e),r=e-i;t*=this.glottis.getNoiseModulator();var o=Math.clamp(8*(.7-n),0,1),s=Math.clamp(30*(n-.3),0,1),a=t*(1-r)*o*s,u=t*r*o*s;this.R[i+1]+=a/2,this.L[i+1]+=a/2,this.R[i+2]+=u/2,this.L[i+2]+=u/2}}]),t}();e.Tract=s},function(t,e,n){var i=n(20),r=n(3),o=n(13);t.exports=function(t,e){var n=(r.Object||{})[t]||Object[t],s={};s[t]=e(n),i(i.S+i.F*o(function(){n(1)}),"Object",s)}},function(t,e,n){var i=n(15)("meta"),r=n(8),o=n(6),s=n(9).f,a=0,u=Object.isExtensible||function(){return!0},h=!n(13)(function(){return u(Object.preventExtensions({}))}),c=function(t){s(t,i,{value:{i:"O"+ ++a,w:{}}})},l=t.exports={KEY:i,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,i)){if(!u(t))return"F";if(!e)return"E";c(t)}return t[i].i},getWeak:function(t,e){if(!o(t,i)){if(!u(t))return!0;if(!e)return!1;c(t)}return t[i].w},onFreeze:function(t){return h&&l.NEED&&u(t)&&!o(t,i)&&c(t),t}}},function(t,e,n){var i=n(8),r=n(37).onFreeze;n(36)("freeze",function(t){return function(e){return t&&i(e)?t(r(e)):e}})},function(t,e,n){n(38),t.exports=n(3).Object.freeze},function(t,e,n){t.exports={default:n(39),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(40)),r=s(n(0)),o=s(n(1));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e,n,i){(0,r.default)(this,t),this.x=e,this.y=n,this.z=i}return(0,o.default)(t,[{key:"dot2",value:function(t,e){return this.x*t+this.y*e}},{key:"dot3",value:function(t,e,n){return this.x*t+this.y*e+this.z*n}}]),t}(),u=new(function(){function t(){(0,r.default)(this,t),this.grad3=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(Date.now())}return(0,o.default)(t,[{key:"seed",value:function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var n;n=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=n,this.gradP[e]=this.gradP[e+256]=this.grad3[n%12]}}},{key:"simplex2",value:function(t,e){var n,i,r=.5*(Math.sqrt(3)-1),o=(3-Math.sqrt(3))/6,s=(t+e)*r,a=Math.floor(t+s),u=Math.floor(e+s),h=(a+u)*o,c=t-a+h,l=e-u+h;c>l?(n=1,i=0):(n=0,i=1);var f=c-n+o,d=l-i+o,p=c-1+2*o,m=l-1+2*o;a&=255,u&=255;var v=this.gradP[a+this.perm[u]],y=this.gradP[a+n+this.perm[u+i]],g=this.gradP[a+1+this.perm[u+1]],b=.5-c*c-l*l,w=.5-f*f-d*d,T=.5-p*p-m*m;return 70*((b<0?0:(b*=b)*b*v.dot2(c,l))+(w<0?0:(w*=w)*w*y.dot2(f,d))+(T<0?0:(T*=T)*T*g.dot2(p,m)))}},{key:"simplex1",value:function(t){return this.simplex2(1.2*t,.7*-t)}}]),t}());(0,i.default)(u),e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Glottis=void 0;var i=s(n(0)),r=s(n(1)),o=s(n(41));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){(0,i.default)(this,t),this.trombone=e,this.timeInWaveform=0,this.oldFrequency=140,this.newFrequency=140,this.UIFrequency=140,this.smoothFrequency=140,this.oldTenseness=.6,this.newTenseness=.6,this.UITenseness=.6,this.totalTime=0,this.vibratoAmount=.005,this.vibratoFrequency=6,this.intensity=0,this.loudness=1,this.isTouched=!1,this.touch=0,this.x=240,this.y=530,this.keyboardTop=500,this.keyboardLeft=0,this.keyboardWidth=600,this.keyboardHeight=100,this.semitones=20,this.marks=[0,0,0,1,0,0,0,0,1,0,1,0,0,0,0],this.baseNote=87.3071,this.output,this.addPitchVariance=!0,this.addTensenessVariance=!0}return(0,r.default)(t,[{key:"init",value:function(){this.setupWaveform(0)}},{key:"handleTouches",value:function(){if(0==this.touch||this.touch.alive||(this.touch=0),0==this.touch)for(var e=0;e<UI.touchesWithMouse.length;e++){var n=UI.touchesWithMouse[e];n.alive&&(n.y<this.keyboardTop||(this.touch=n))}if(0!=this.touch){var i=this.touch.y-this.keyboardTop-10,r=this.touch.x-this.keyboardLeft;i=Math.clamp(i,0,this.keyboardHeight-26);var o=this.semitones*r/this.keyboardWidth+.5;t.UIFrequency=this.baseNote*Math.pow(2,o/12),0==t.intensity&&(t.smoothFrequency=t.UIFrequency);var s=Math.clamp(1-i/(this.keyboardHeight-28),0,1);t.UITenseness=1-Math.cos(s*Math.PI*.5),t.loudness=Math.pow(t.UITenseness,.25),this.x=this.touch.x,this.y=i+this.keyboardTop+10}t.isTouched=0!=this.touch}},{key:"runStep",value:function(t,e){var n=1/this.trombone.audioSystem.sampleRate;this.timeInWaveform+=n,this.totalTime+=n,this.timeInWaveform>this.waveformLength&&(this.timeInWaveform-=this.waveformLength,this.setupWaveform(t));var i=this.normalizedLFWaveform(this.timeInWaveform/this.waveformLength),r=this.intensity*(1-Math.sqrt(this.UITenseness))*this.getNoiseModulator()*e;return i+=r*=.2+.02*o.default.simplex1(1.99*this.totalTime)}},{key:"getNoiseModulator",value:function(){var t=.1+.2*Math.max(0,Math.sin(2*Math.PI*this.timeInWaveform/this.waveformLength));return this.UITenseness*this.intensity*t+.3*(1-this.UITenseness*this.intensity)}},{key:"finishBlock",value:function(){var t=0;this.addPitchVariance&&(t+=this.vibratoAmount*Math.sin(2*Math.PI*this.totalTime*this.vibratoFrequency),t+=.02*o.default.simplex1(4.07*this.totalTime),t+=.04*o.default.simplex1(2.15*this.totalTime)),this.trombone.autoWobble&&(t+=.2*o.default.simplex1(.98*this.totalTime),t+=.4*o.default.simplex1(.5*this.totalTime)),this.UIFrequency>this.smoothFrequency&&(this.smoothFrequency=Math.min(1.1*this.smoothFrequency,this.UIFrequency)),this.UIFrequency<this.smoothFrequency&&(this.smoothFrequency=Math.max(this.smoothFrequency/1.1,this.UIFrequency)),this.oldFrequency=this.newFrequency,this.newFrequency=this.smoothFrequency*(1+t),this.oldTenseness=this.newTenseness,this.addTensenessVariance?this.newTenseness=this.UITenseness+.1*o.default.simplex1(.46*this.totalTime)+.05*o.default.simplex1(.36*this.totalTime):this.newTenseness=this.UITenseness,!this.isTouched&&this.trombone.alwaysVoice&&(this.newTenseness+=(3-this.UITenseness)*(1-this.intensity)),(this.isTouched||this.trombone.alwaysVoice)&&(this.intensity+=.13),this.intensity=Math.clamp(this.intensity,0,1)}},{key:"setupWaveform",value:function(t){this.frequency=this.oldFrequency*(1-t)+this.newFrequency*t;var e=this.oldTenseness*(1-t)+this.newTenseness*t;this.Rd=3*(1-e),this.waveformLength=1/this.frequency;var n=this.Rd;n<.5&&(n=.5),n>2.7&&(n=2.7);var i=.048*n-.01,r=.224+.118*n,o=1/(2*(r/4*(.5+1.2*r)/(.11*n-i*(.5+1.2*r)))),s=o+o*r,a=1/i,u=Math.exp(-a*(1-s)),h=1-u,c=1/a*(u-1)+(1-s)*u,l=-(-(s-o)/2+(c/=h)),f=Math.PI/o,d=Math.sin(f*s),p=-Math.PI*d*l/(2*o),m=Math.log(p)/(o/2-s),v=-1/(d*Math.exp(m*s));this.alpha=m,this.E0=v,this.epsilon=a,this.shift=u,this.Delta=h,this.Te=s,this.omega=f}},{key:"normalizedLFWaveform",value:function(t){return t>this.Te?this.output=(-Math.exp(-this.epsilon*(t-this.Te))+this.shift)/this.Delta:this.output=this.E0*Math.exp(this.alpha*t)*Math.sin(this.omega*t),this.output*this.intensity*this.loudness}}]),t}();e.Glottis=a},function(t,e,n){"use strict";var i=s(n(12)),r=s(n(0)),o=s(n(1));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(e){(0,r.default)(this,t),this.trombone=e,this.blockLength=512,this.blockTime=1,this.soundOn=!1}return(0,o.default)(t,[{key:"init",value:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new window.AudioContext,this.sampleRate=this.audioContext.sampleRate,this.blockTime=this.blockLength/this.sampleRate,this.processors=[]}},{key:"startSound",value:function(){for(var t=this,e=function(e){var n=t.audioContext.createScriptProcessor(t.blockLength,2,1);n.connect(t.audioContext.destination),n.onaudioprocess=function(n){t.doScriptProcessor(n,e)},i=t.createWhiteNoiseNode(2*t.sampleRate),(r=t.audioContext.createBiquadFilter()).type="bandpass",r.frequency.value=500,r.Q.value=.5,i.connect(r),r.connect(n),(o=t.audioContext.createBiquadFilter()).type="bandpass",o.frequency.value=1e3,o.Q.value=.5,i.connect(o),o.connect(n),i.start(0),t.processors.push(n)},n=0;n<this.trombone.voices.length;n++){var i,r,o;e(n)}}},{key:"createWhiteNoiseNode",value:function(t){for(var e=this.audioContext.createBuffer(1,t,this.sampleRate),n=e.getChannelData(0),i=0;i<t;i++)n[i]=Math.random();var r=this.audioContext.createBufferSource();return r.buffer=e,r.loop=!0,r}},{key:"doScriptProcessor",value:function(t,e){for(var n=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1),r=t.outputBuffer.getChannelData(0),o=this.trombone.voices[e],s=r.length,a=0;a<s;a++){var u=a/s,h=(a+.5)/s,c=o.glottis.runStep(u,n[a]),l=0;o.tract.runStep(c,i[a],u),l+=o.tract.lipOutput+o.tract.noseOutput,o.tract.runStep(c,i[a],h),l+=o.tract.lipOutput+o.tract.noseOutput,r[a]=.125*l}o.glottis.finishBlock(),o.tract.finishBlock()}},{key:"mute",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=(0,i.default)(this.processors);!(t=(r=o.next()).done);t=!0){r.value.disconnect()}}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}}},{key:"unmute",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,o=(0,i.default)(this.processors);!(t=(r=o.next()).done);t=!0){r.value.connect(this.audioContext.destination)}}catch(t){e=!0,n=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw n}}}}]),t}();e.AudioSystem=a},function(t,e,n){"use strict";Math.clamp=function(t,e,n){return t<e?e:t>n?n:t},Math.moveTowards=function(t,e,n){return t<e?Math.min(t+n,e):Math.max(t-n,e)},Math.moveTowards=function(t,e,n,i){return t<e?Math.min(t+n,e):Math.max(t-i,e)},Math.gaussian=function(){for(var t=0,e=0;e<16;e++)t+=Math.random();return(t-8)/4},Math.lerp=function(t,e,n){return t+(e-t)*n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Voice=e.PinkTrombone=void 0;var i=h(n(1)),r=h(n(0));n(44);var o=n(43),s=n(42),a=n(35),u=n(34);function h(t){return t&&t.__esModule?t:{default:t}}var c=function t(e,n){(0,r.default)(this,t),this.id=n,this.glottis=new s.Glottis(e),this.glottis.init(),this.tract=new a.Tract(e,this.glottis),this.tract.init(),this.tractUI=new u.TractUI(e,this.tract),this.tractUI.init()},l=function(){function t(e){(0,r.default)(this,t),this.controller=e,this.time=0,this.alwaysVoice=!0,this.autoWobble=!0,this.noiseFreq=500,this.noiseQ=.7,this.voices=[];for(var n=0;n<8;n++){var i=new c(this,n);i.glottis.loudness=0==n?1:0,this.voices.push(i)}this.audioSystem=new o.AudioSystem(this),this.audioSystem.init(),this.muted=!1}return(0,i.default)(t,[{key:"StartAudio",value:function(){this.muted=!1,this.audioSystem.startSound()}},{key:"SetMute",value:function(t){t?this.audioSystem.mute():this.audioSystem.unmute(),this.muted=t}},{key:"ToggleMute",value:function(){this.SetMute(!this.muted)}}]),t}();e.PinkTrombone=l,e.Voice=c},function(t,e,n){var i,r,o;r=[],void 0===(o="function"==typeof(i=function(){var t=function(t,e){this._dragged=!1,this._element=t,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,e),t.addEventListener("touchstart",this._bindedEnd),t.addEventListener("touchmove",this._bindedMove),t.addEventListener("touchend",this._bindedEnd),t.addEventListener("mouseup",this._bindedEnd)};function e(t){return"running"===t.state}return t.prototype._moved=function(t){this._dragged=!0},t.prototype._ended=function(t){this._dragged||function(t){var e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0),t.resume&&t.resume()}(t),this._dragged=!1},t.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(n,i,r){var o=new Promise(function(t){!function(t,n){e(t)?n():function i(){e(t)?n():(requestAnimationFrame(i),t.resume&&t.resume())}()}(n,t)}),s=[];return i||(i=document.body),function e(n,i,r){if(Array.isArray(n)||NodeList&&n instanceof NodeList)for(var o=0;o<n.length;o++)e(n[o],i,r);else if("string"==typeof n)e(document.querySelectorAll(n),i,r);else if(n.jquery&&"function"==typeof n.toArray)e(n.toArray(),i,r);else if(Element&&n instanceof Element){var s=new t(n,r);i.push(s)}}(i,s,n),o.then(function(){for(var t=0;t<s.length;t++)s[t].dispose();s=null,r&&r()}),o}})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StartOverlay=void 0;var i=o(n(0)),r=o(n(46));function o(t){return t&&t.__esModule?t:{default:t}}e.StartOverlay=function t(e,n){(0,i.default)(this,t),this.container=e;var o=document.createElement("div");this.container.appendChild(o),o.style.cssText="\n            width: 100%;\n            height: 100%;\n            text-align: center;\n            position: absolute;\n            left: 0;\n            top: 0;\n            display: block;\n            background-color: rgba(0, 0, 0, 0.5);\n        ",o.innerHTML='\n            <div style="position: absolute; margin: auto; top: 0; right: 0; bottom: 0; left: 0; width: 100px; height: 100px;">\n                <p class="jon-trombone-audio-overlay-text">\n                    Tap here to begin.\n                </p>\n            </div>\n        ',(0,r.default)(n,o,function(){console.log("Unlocked iOS audio"),o.remove()})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ModelLoader=void 0;var i=s(n(12)),r=s(n(0)),o=s(n(1));function s(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(){(0,r.default)(this,t)}return(0,o.default)(t,null,[{key:"LoadOBJ",value:function(t,e){var n=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},i=function(t){},r=new THREE.MTLLoader;r.setPath(t.path),r.load(t.mtlFile,function(r){r.preload();var o=new THREE.OBJLoader;o.setMaterials(r),o.setPath(t.path),o.load(t.objFile,function(t){e(t)},n,i)})}},{key:"LoadJSON",value:function(t,e){(new THREE.JSONLoader).load(t,function(t,n){var r=!0,o=!1,s=void 0;try{for(var a,u=(0,i.default)(n);!(r=(a=u.next()).done);r=!0){a.value.skinning=!0}}catch(t){o=!0,s=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}var h=new THREE.SkinnedMesh(t,new THREE.MultiMaterial(n));h.name="Jon",e(h)},function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},function(t){})}},{key:"LoadFBX",value:function(t,e){var n=new THREE.LoadingManager;n.onProgress=function(t,e,n){console.log(t,e,n)};new THREE.FBXLoader(n).load(t,function(t){e(t)},function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},function(t){})}}]),t}();e.ModelLoader=a},function(t,e,n){var i=n(25),r=n(2)("toStringTag"),o="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?n:o?i(e):"Object"==(s=i(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,n){var i=n(49),r=n(2)("iterator"),o=n(11);t.exports=n(3).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[i(t)]}},function(t,e,n){var i=n(14),r=n(50);t.exports=n(3).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},function(t,e,n){var i=n(17),r=n(18);t.exports=function(t){return function(e,n){var o,s,a=String(r(e)),u=i(n),h=a.length;return u<0||u>=h?t?"":void 0:(o=a.charCodeAt(u))<55296||o>56319||u+1===h||(s=a.charCodeAt(u+1))<56320||s>57343?t?a.charAt(u):o:t?a.slice(u,u+2):s-56320+(o-55296<<10)+65536}}},function(t,e,n){"use strict";var i=n(52)(!0);n(24)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){var i=n(18);t.exports=function(t){return Object(i(t))}},function(t,e,n){var i=n(6),r=n(54),o=n(16)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),i(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,n){var i=n(4).document;t.exports=i&&i.documentElement},function(t,e,n){var i=n(17),r=Math.max,o=Math.min;t.exports=function(t,e){return(t=i(t))<0?r(t+e,0):o(t,e)}},function(t,e,n){var i=n(17),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},function(t,e,n){var i=n(19),r=n(58),o=n(57);t.exports=function(t){return function(e,n,s){var a,u=i(e),h=r(u.length),c=o(s,h);if(t&&n!=n){for(;h>c;)if((a=u[c++])!=a)return!0}else for(;h>c;c++)if((t||c in u)&&u[c]===n)return t||c||0;return!t&&-1}}},function(t,e,n){var i=n(6),r=n(19),o=n(59)(!1),s=n(16)("IE_PROTO");t.exports=function(t,e){var n,a=r(t),u=0,h=[];for(n in a)n!=s&&i(a,n)&&h.push(n);for(;e.length>u;)i(a,n=e[u++])&&(~o(h,n)||h.push(n));return h}},function(t,e,n){var i=n(60),r=n(22);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e,n){var i=n(9),r=n(14),o=n(61);t.exports=n(7)?Object.defineProperties:function(t,e){r(t);for(var n,s=o(e),a=s.length,u=0;a>u;)i.f(t,n=s[u++],e[n]);return t}},function(t,e,n){var i=n(14),r=n(62),o=n(22),s=n(16)("IE_PROTO"),a=function(){},u=function(){var t,e=n(27)("iframe"),i=o.length;for(e.style.display="none",n(56).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;i--;)delete u.prototype[o[i]];return u()};t.exports=Object.create||function(t,e){var n;return null!==t?(a.prototype=i(t),n=new a,a.prototype=null,n[s]=t):n=u(),void 0===e?n:r(n,e)}},function(t,e,n){"use strict";var i=n(63),r=n(26),o=n(21),s={};n(10)(s,n(2)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=i(s,{next:r(1,n)}),o(t,e+" Iterator")}},function(t,e,n){t.exports=n(10)},function(t,e){t.exports=!0},function(t,e,n){var i=n(25);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e){t.exports=function(){}},function(t,e,n){"use strict";var i=n(69),r=n(68),o=n(11),s=n(19);t.exports=n(24)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(t,e,n){n(70);for(var i=n(4),r=n(10),o=n(11),s=n(2)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var h=a[u],c=i[h],l=c&&c.prototype;l&&!l[s]&&r(l,s,h),o[h]=o.Array}},function(t,e,n){n(71),n(53),t.exports=n(51)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JonTrombone=void 0;var i=l(n(12)),r=l(n(0)),o=l(n(1)),s=n(48),a=n(47),u=n(45),h=n(33),c=(n(31),n(30));function l(t){return t&&t.__esModule?t:{default:t}}var f=function(){function t(e,n){var i=this;(0,r.default)(this,t),this.container=e,this.container.style.position="relative",this.container.style.cursor="default",this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement);var o=this.container.offsetWidth/this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(45,o,.1,100),this.scene=new THREE.Scene,this.clock=new THREE.Clock;this.trombone=new u.PinkTrombone(this),setTimeout(function(){i.trombone.StartAudio(),i.moveJaw=!0},1e3),this.jawFlapSpeed=20,this.jawOpenOffset=.19,this.moveJaw=!1,this.legato=!1,this.flapWhileSinging=!1,this.midiController=new h.MidiController(this),this.SetUpThree(),this.SetUpScene();new a.StartOverlay(this.container,this.trombone.audioSystem.audioContext);this.OnUpdate(),c.gui.Init(this,this.container)}return(0,o.default)(t,[{key:"SetUpThree",value:function(){void 0!==THREE.OrbitControls?(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.update()):console.warn("No THREE.OrbitControls detected. Include to allow interaction with the model.")}},{key:"SetUpScene",value:function(){var t=this;this.camera.position.set(0,0,.5);var e=new THREE.HemisphereLight(16777215,4473924,1);e.name="Hemisphere Light",e.position.set(0,1,0),this.scene.add(e);var n=new THREE.DirectionalLight(16777215,1);n.name="Directional Light",n.position.set(0,1,1),n.target.position.set(0,0,0),this.scene.add(n),s.ModelLoader.LoadJSON("../resources/jon/three/jon.json",function(e){t.jon=e,t.scene.add(t.jon),t.jon.rotation.y=THREE.Math.degToRad(15),t.jaw=t.jon.skeleton.bones.find(function(t){return"Bone.006"==t.name}),t.jaw&&(t.jawShutZ=t.jaw.position.z)})}},{key:"OnUpdate",value:function(){this.clock.getDelta();if(requestAnimationFrame(this.OnUpdate.bind(this)),this.midiController.playing){var t=this.midiController.GetPitches();if(t!=this.lastNotes){if(void 0!==t){for(var e=0;e<this.trombone.voices.length;e++)e>=t.length?(this.legato||(this.trombone.voices[e].glottis.loudness=0),this.moveJaw&&this.trombone.voices[e].tractUI.SetLipsClosed(1)):(this.trombone.voices[e].glottis.UIFrequency=this.midiController.MIDIToFrequency(t[e].midi),this.trombone.voices[e].glottis.loudness=t[e].velocity,this.moveJaw&&this.trombone.voices[e].tractUI.SetLipsClosed(0));this.moveJaw&&(this.jaw.position.z=this.jawShutZ+this.jawOpenOffset);var n=!0,r=!1,o=void 0;try{for(var s,a=(0,i.default)(this.trombone.voices);!(n=(s=a.next()).done);n=!0){var u=s.value;this.moveJaw&&u.tractUI.SetLipsClosed(0)}}catch(t){r=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}0==t.length&&this.moveJaw&&(this.jaw.position.z=this.jawShutZ),this.lastNotes=t}}if(this.jaw&&this.moveJaw&&(!this.midiController.playing||this.flapWhileSinging)){var h=this.clock.getElapsedTime(),c=(Math.sin(h*this.jawFlapSpeed)+1)/2;this.jaw.position.z=this.jawShutZ+c*this.jawOpenOffset;var l=!0,f=!1,d=void 0;try{for(var p,m=(0,i.default)(this.trombone.voices);!(l=(p=m.next()).done);l=!0){p.value.tractUI.SetLipsClosed(1-c)}}catch(t){f=!0,d=t}finally{try{!l&&m.return&&m.return()}finally{if(f)throw d}}}this.renderer.render(this.scene,this.camera)}}]),t}();e.JonTrombone=f},function(t,e,n){var i=n(8);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){t.exports=!n(7)&&!n(13)(function(){return 7!=Object.defineProperty(n(27)("div"),"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var i=n(76);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var i=n(20);i(i.S+i.F*!n(7),"Object",{defineProperty:n(9).f})},function(t,e,n){n(78);var i=n(3).Object;t.exports=function(t,e,n){return i.defineProperty(t,e,n)}},function(t,e,n){t.exports={default:n(79),__esModule:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Detector=void 0;var i=o(n(0)),r=o(n(1));function o(t){return t&&t.__esModule?t:{default:t}}var s=function(){function t(){(0,i.default)(this,t)}return(0,r.default)(t,null,[{key:"HasWebGL",value:function(){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),e=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,i=0;i<4;i++)try{if((n=t.getContext(e[i]))&&"function"==typeof n.getParameter)return!0}catch(t){}return!1}return!1}},{key:"GetErrorHTML",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t&&(t='Your graphics card does not seem to support \n                        <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>. <br>\n                        Find out how to get it <a href="http://get.webgl.org/">here</a>.'),'\n        <div class="no-webgl-support">\n        <p style="text-align: center;">'+t+"</p>\n        </div>\n        "}}]),t}();e.Detector=s},function(t,e,n){"use strict";var i=n(81),r=n(73),o=function(){var t=document.getElementById("jon-trombone-container");if(i.Detector.HasWebGL())new r.JonTrombone(t);else console.log("WebGL is not supported on this browser."),t.innerHTML=i.Detector.GetErrorHTML(),t.classList.add("no-webgl")};"complete"===document.readyState?o():window.onload=function(){o()}}])});
//# sourceMappingURL=jon-trombone.js.map