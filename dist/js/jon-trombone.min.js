!function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return r(n||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){i(this,t)}return r(t,null,[{key:"Init",value:function(t){if("undefined"==typeof dat)return void console.warn("No DAT.GUI instance found. Import on the page to use!");var e=new dat.GUI({}),n=t;e.add(n.trombone,"ToggleMute");var i=e.addFolder("Jon");i.add(n,"moveJaw").listen(),i.add(n,"jawFlapSpeed").min(0).max(100),i.add(n,"jawOpenOffset").min(0).max(1);var r=e.addFolder("Voice");r.add(n.trombone,"autoWobble"),r.add(n.trombone.Glottis,"addPitchVariance").listen(),r.add(n.trombone.Glottis,"addTensenessVariance").listen(),r.add(n.trombone.Glottis,"UITenseness").min(0).max(1),r.add(n.trombone.Glottis,"vibratoAmount").min(0).max(.5),r.add(n.trombone.Glottis,"UIFrequency").min(1).max(1e3).listen(),r.add(n.trombone.Glottis,"loudness").min(0).max(1).listen();var o=e.addFolder("Tract");o.add(n.trombone.Tract,"movementSpeed").min(1).max(30).step(1),o.add(n.trombone.Tract,"velumTarget").min(.001).max(2),o.add(n.trombone.TractUI,"target").min(.001).max(1),o.add(n.trombone.TractUI,"index").min(0).max(43).step(1),o.add(n.trombone.TractUI,"radius").min(0).max(5).step(1);var s=e.addFolder("midi");s.add(n.midiController,"PlaySong"),s.add(n.midiController,"Stop"),s.add(n.midiController,"Restart"),s.add(n.midiController,"currentTrack").min(0).max(20).step(1).listen(),s.add(n.midiController,"baseFreq").min(1).max(2e3),s.add(n,"flapWhileSinging"),s.add(n,"legato").listen()}}]),t}();n.GUI=o},{}],2:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.JonTrombone=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("./utils/model-loader.js"),s=t("./pink-trombone/pink-trombone.js"),a=t("./midi/midi-controller.js"),u=t("./midi/midi-drop-area.js"),h=function(){function t(e){var n=this;i(this,t),this.container=e,this.container.style.position="relative",this.container.style.cursor="default",this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement);var r=this.container.offsetWidth/this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(45,r,.1,100),this.scene=new THREE.Scene,this.clock=new THREE.Clock;this.trombone=new s.PinkTrombone,setTimeout(function(){n.trombone.StartAudio(),n.moveJaw=!0},1e3),this.jawFlapSpeed=20,this.jawOpenOffset=.19,this.moveJaw=!1,this.legato=!1,this.flapWhileSinging=!1,this.midiController=new a.MidiController(this);new u.MidiDropArea(this);this.SetUpThree(),this.SetUpScene(),this.OnUpdate()}return r(t,[{key:"SetUpThree",value:function(){void 0!==THREE.OrbitControls?(this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.update()):console.warn("No THREE.OrbitControls detected. Include to allow interaction with the model.")}},{key:"SetUpScene",value:function(){var t=this;this.camera.position.set(0,0,.5);var e=new THREE.HemisphereLight(16777215,4473924,1);e.name="Hemisphere Light",e.position.set(0,1,0),this.scene.add(e);var n=new THREE.DirectionalLight(16777215,1);n.name="Directional Light",n.position.set(0,1,0),this.scene.add(n),o.ModelLoader.LoadJSON("../resources/jon/three/jon.json",function(e){t.jon=e,t.scene.add(t.jon),t.jon.rotation.y=THREE.Math.degToRad(15),t.jaw=t.jon.skeleton.bones.find(function(t){return"Bone.006"==t.name}),t.jaw&&(t.jawShutZ=t.jaw.position.z)})}},{key:"OnUpdate",value:function(){this.clock.getDelta();if(requestAnimationFrame(this.OnUpdate.bind(this)),this.midiController.playing){var t=this.midiController.GetPitch();if(t!=this.lastNote){if(void 0===t)this.legato||(this.trombone.Glottis.loudness=0),this.jaw.position.z=this.jawShutZ,this.trombone.TractUI.SetLipsClosed(1);else{var e=this.midiController.MIDIToFrequency(t.midi);this.trombone.Glottis.UIFrequency=e,this.trombone.Glottis.loudness=t.velocity,this.jaw.position.z=this.jawShutZ+this.jawOpenOffset,this.trombone.TractUI.SetLipsClosed(0)}this.lastNote=t}}if(this.jaw&&this.moveJaw&&(!this.midiController.playing||this.flapWhileSinging)){var n=this.clock.getElapsedTime(),i=(Math.sin(n*this.jawFlapSpeed)+1)/2;this.jaw.position.z=this.jawShutZ+i*this.jawOpenOffset,this.trombone.TractUI.SetLipsClosed(1-i)}this.renderer.render(this.scene,this.camera)}}]),t}();n.JonTrombone=h},{"./midi/midi-controller.js":4,"./midi/midi-drop-area.js":5,"./pink-trombone/pink-trombone.js":12,"./utils/model-loader.js":13}],3:[function(t,e,n){"use strict";var i=t("./utils/webgl-detect.js"),r=t("./jon-trombone.js"),o=t("./gui.js"),s=document.getElementById("jon-trombone-container");if(i.Detector.HasWebGL()){var a=new r.JonTrombone(s);o.GUI.Init(a)}else console.log("WebGL is not supported on this browser."),s.innerHTML=i.Detector.GetErrorHTML(),s.classList.add("no-webgl")},{"./gui.js":1,"./jon-trombone.js":2,"./utils/webgl-detect.js":14}],4:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("midiconvert"),s=function(){function t(e){i(this,t),this.controller=e,this.midi=null,this.playing=!1,this.currentTrack=5,this.baseFreq=110,this.clock=new THREE.Clock(!1)}return r(t,[{key:"LoadSong",value:function(t,e){var n=this;this.Stop(),this.midi=null,o.load(t,function(t){console.log("MIDI loaded."),n.midi=t,console.log(n.midi),e&&e(t)})}},{key:"LoadSongDirect",value:function(t){this.Stop(),this.midi=o.parse(t),console.log("MIDI loaded."),console.log(this.midi)}},{key:"GetPitch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentTrack,e=this.GetSongProgress();return t=Math.min(t,this.midi.tracks.length-1),t=Math.max(t,0),this.midi.tracks[t].notes.find(function(t){return t.noteOn<=e&&e<=t.noteOff})}},{key:"PlaySong",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;if(!this.playing){if(!this.midi)return console.log("No MIDI is loaded. Loading an example..."),void this.LoadSong("../resources/midi/un-owen-was-her.mid",function(){t.PlaySong()});this.EnterSingMode(),this.currentTrack=e,this.clock.start(),this.playing=!0,console.log("Playback started.")}}},{key:"GetSongProgress",value:function(){return this.clock.getElapsedTime()}},{key:"MIDIToFrequency",value:function(t){return this.baseFreq*Math.pow(2,(t-57)/12)}},{key:"Restart",value:function(){console.log("Playback moved to beginning."),this.clock=new THREE.Clock}},{key:"Stop",value:function(){this.playing&&(console.log("Playback stopped."),this.clock.stop(),this.playing=!1,this.ExitSingMode())}},{key:"EnterSingMode",value:function(){this.backup_settings||(this.backup_settings={},this.backup_settings.autoWobble=this.controller.trombone.autoWobble,this.controller.trombone.autoWobble=!1,this.backup_settings.addPitchVariance=this.controller.trombone.Glottis.addPitchVariance,this.controller.trombone.Glottis.addPitchVariance=!1,this.backup_settings.addTensenessVariance=this.controller.trombone.Glottis.addTensenessVariance,this.controller.trombone.Glottis.addTensenessVariance=!1,this.backup_settings.vibratoFrequency=this.controller.trombone.Glottis.vibratoFrequency,this.controller.trombone.Glottis.vibratoFrequency=0,this.backup_settings.frequency=this.controller.trombone.Glottis.UIFrequency,this.backup_settings.loudness=this.controller.trombone.Glottis.loudness)}},{key:"ExitSingMode",value:function(){this.backup_settings&&(this.controller.trombone.autoWobble=this.backup_settings.autoWobble,this.controller.trombone.Glottis.addPitchVariance=this.backup_settings.addPitchVariance,this.controller.trombone.Glottis.addTensenessVariance=this.backup_settings.addTensenessVariance,this.controller.trombone.Glottis.vibratoFrequency=this.backup_settings.vibratoFrequency,this.controller.trombone.Glottis.UIFrequency=this.backup_settings.frequency,this.controller.trombone.Glottis.loudness=this.backup_settings.loudness,this.backup_settings=null)}}]),t}();n.MidiController=s},{midiconvert:15}],5:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n.MidiDropArea=function(){function t(e){var n=this;i(this,t),this.controller=e,this.dropArea=document.createElement("div"),this.dropArea.style.position="absolute",this.dropArea.style.top="0",this.dropArea.style.left="0",this.dropArea.style.width="100%",this.dropArea.style.height="100%",this.MakeDroppable(this.dropArea,function(t){var e=new FileReader;e.onload=function(t){n.controller.midiController.LoadSongDirect(e.result)},e.readAsBinaryString(t[0])}),this.controller.container.appendChild(this.dropArea)}return r(t,[{key:"Callback",value:function(){console.log("Callback")}},{key:"MakeDroppable",value:function(t,e){function n(t){var n;t.dataTransfer?n=t.dataTransfer.files:t.target&&(n=t.target.files),e.call(null,n)}var i=document.createElement("input");i.setAttribute("type","file"),i.setAttribute("multiple",!0),i.style.display="none",i.addEventListener("change",n),t.appendChild(i),t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("dragover")}),t.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("dragover")}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("dragover"),n(e)})}}]),t}()},{}],6:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.trombone=e,this.blockLength=512,this.blockTime=1,this.soundOn=!1,this.useWhiteNoise=!0}return r(t,[{key:"init",value:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new window.AudioContext,this.trombone.sampleRate=this.audioContext.sampleRate,this.blockTime=this.blockLength/this.trombone.sampleRate}},{key:"startSound",value:function(){this.scriptProcessor=this.audioContext.createScriptProcessor(this.blockLength,2,1),this.scriptProcessor.connect(this.audioContext.destination),this.scriptProcessor.onaudioprocess=this.doScriptProcessor.bind(this);var t=this.createWhiteNoiseNode(2*this.trombone.sampleRate),e=this.audioContext.createBiquadFilter();e.type="bandpass",e.frequency.value=500,e.Q.value=.5,t.connect(e),e.connect(this.scriptProcessor);var n=this.audioContext.createBiquadFilter();n.type="bandpass",n.frequency.value=1e3,n.Q.value=.5,t.connect(n),n.connect(this.scriptProcessor),t.start(0)}},{key:"createWhiteNoiseNode",value:function(t){for(var e=this.audioContext.createBuffer(1,t,this.trombone.sampleRate),n=e.getChannelData(0),i=0;i<t;i++)n[i]=this.useWhiteNoise?Math.random():1;var r=this.audioContext.createBufferSource();return r.buffer=e,r.loop=!0,r}},{key:"doScriptProcessor",value:function(t){for(var e=t.inputBuffer.getChannelData(0),n=t.inputBuffer.getChannelData(1),i=t.outputBuffer.getChannelData(0),r=0,o=i.length;r<o;r++){var s=r/o,a=(r+.5)/o,u=this.trombone.Glottis.runStep(s,e[r]),h=0;this.trombone.Tract.runStep(u,n[r],s),h+=this.trombone.Tract.lipOutput+this.trombone.Tract.noseOutput,this.trombone.Tract.runStep(u,n[r],a),h+=this.trombone.Tract.lipOutput+this.trombone.Tract.noseOutput,i[r]=.125*h}this.trombone.Glottis.finishBlock(),this.trombone.Tract.finishBlock()}},{key:"mute",value:function(){this.scriptProcessor.disconnect()}},{key:"unmute",value:function(){this.scriptProcessor.connect(this.audioContext.destination)}}]),t}();n.AudioSystem=o},{}],7:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.Glottis=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=t("../noise.js"),s=function(t){return t&&t.__esModule?t:{default:t}}(o),a=function(){function t(e){i(this,t),this.trombone=e,this.timeInWaveform=0,this.oldFrequency=140,this.newFrequency=140,this.UIFrequency=140,this.smoothFrequency=140,this.oldTenseness=.6,this.newTenseness=.6,this.UITenseness=.6,this.totalTime=0,this.vibratoAmount=.005,this.vibratoFrequency=6,this.intensity=0,this.loudness=1,this.isTouched=!1,this.touch=0,this.x=240,this.y=530,this.keyboardTop=500,this.keyboardLeft=0,this.keyboardWidth=600,this.keyboardHeight=100,this.semitones=20,this.marks=[0,0,0,1,0,0,0,0,1,0,1,0,0,0,0],this.baseNote=87.3071,this.output,this.addPitchVariance=!0,this.addTensenessVariance=!0}return r(t,[{key:"init",value:function(){this.setupWaveform(0)}},{key:"handleTouches",value:function(){if(0==this.touch||this.touch.alive||(this.touch=0),0==this.touch)for(var e=0;e<UI.touchesWithMouse.length;e++){var n=UI.touchesWithMouse[e];n.alive&&(n.y<this.keyboardTop||(this.touch=n))}if(0!=this.touch){var i=this.touch.y-this.keyboardTop-10,r=this.touch.x-this.keyboardLeft;i=Math.clamp(i,0,this.keyboardHeight-26);var o=this.semitones*r/this.keyboardWidth+.5;t.UIFrequency=this.baseNote*Math.pow(2,o/12),0==t.intensity&&(t.smoothFrequency=t.UIFrequency);var s=Math.clamp(1-i/(this.keyboardHeight-28),0,1);t.UITenseness=1-Math.cos(s*Math.PI*.5),t.loudness=Math.pow(t.UITenseness,.25),this.x=this.touch.x,this.y=i+this.keyboardTop+10}t.isTouched=0!=this.touch}},{key:"runStep",value:function(t,e){var n=1/this.trombone.sampleRate;this.timeInWaveform+=n,this.totalTime+=n,this.timeInWaveform>this.waveformLength&&(this.timeInWaveform-=this.waveformLength,this.setupWaveform(t));var i=this.normalizedLFWaveform(this.timeInWaveform/this.waveformLength),r=this.intensity*(1-Math.sqrt(this.UITenseness))*this.getNoiseModulator()*e;return r*=.2+.02*s.default.simplex1(1.99*this.totalTime),i+=r}},{key:"getNoiseModulator",value:function(){var t=.1+.2*Math.max(0,Math.sin(2*Math.PI*this.timeInWaveform/this.waveformLength));return this.UITenseness*this.intensity*t+.3*(1-this.UITenseness*this.intensity)}},{key:"finishBlock",value:function(){var t=0;this.addPitchVariance&&(t+=this.vibratoAmount*Math.sin(2*Math.PI*this.totalTime*this.vibratoFrequency),t+=.02*s.default.simplex1(4.07*this.totalTime),t+=.04*s.default.simplex1(2.15*this.totalTime)),this.trombone.autoWobble&&(t+=.2*s.default.simplex1(.98*this.totalTime),t+=.4*s.default.simplex1(.5*this.totalTime)),this.UIFrequency>this.smoothFrequency&&(this.smoothFrequency=Math.min(1.1*this.smoothFrequency,this.UIFrequency)),this.UIFrequency<this.smoothFrequency&&(this.smoothFrequency=Math.max(this.smoothFrequency/1.1,this.UIFrequency)),this.oldFrequency=this.newFrequency,this.newFrequency=this.smoothFrequency*(1+t),this.oldTenseness=this.newTenseness,this.addTensenessVariance?this.newTenseness=this.UITenseness+.1*s.default.simplex1(.46*this.totalTime)+.05*s.default.simplex1(.36*this.totalTime):this.newTenseness=this.UITenseness,!this.isTouched&&this.trombone.alwaysVoice&&(this.newTenseness+=(3-this.UITenseness)*(1-this.intensity)),(this.isTouched||this.trombone.alwaysVoice)&&(this.intensity+=.13),this.intensity=Math.clamp(this.intensity,0,1)}},{key:"setupWaveform",value:function(t){this.frequency=this.oldFrequency*(1-t)+this.newFrequency*t;var e=this.oldTenseness*(1-t)+this.newTenseness*t;this.Rd=3*(1-e),this.waveformLength=1/this.frequency;var n=this.Rd;n<.5&&(n=.5),n>2.7&&(n=2.7);var i=.048*n-.01,r=.224+.118*n,o=r/4*(.5+1.2*r)/(.11*n-i*(.5+1.2*r)),s=i,a=1/(2*o),u=a+a*r,h=1/s,c=Math.exp(-h*(1-u)),l=1-c,f=1/h*(c-1)+(1-u)*c;f/=l;var d=-(u-a)/2+f,p=-d,m=Math.PI/a,v=Math.sin(m*u),y=-Math.PI*v*p/(2*a),b=Math.log(y),g=b/(a/2-u),w=-1/(v*Math.exp(g*u));this.alpha=g,this.E0=w,this.epsilon=h,this.shift=c,this.Delta=l,this.Te=u,this.omega=m}},{key:"normalizedLFWaveform",value:function(t){return t>this.Te?this.output=(-Math.exp(-this.epsilon*(t-this.Te))+this.shift)/this.Delta:this.output=this.E0*Math.exp(this.alpha*t)*Math.sin(this.omega*t),this.output*this.intensity*this.loudness}}]),t}();n.Glottis=a},{"../noise.js":11}],8:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.trombone=e,this.originX=340,this.originY=449,this.radius=298,this.scale=60,this.tongueIndex=12.9,this.tongueDiameter=2.43,this.innerTongueControlRadius=2.05,this.outerTongueControlRadius=3.5,this.tongueTouch=0,this.angleScale=.64,this.angleOffset=-.24,this.noseOffset=.8,this.gridOffset=1.7,this.target=.1,this.index=42,this.radius=0}return r(t,[{key:"init",value:function(){var t=this.trombone.Tract;this.setRestDiameter();for(var e=0;e<t.n;e++)t.diameter[e]=t.targetDiameter[e]=t.restDiameter[e];this.tongueLowerIndexBound=t.bladeStart+2,this.tongueUpperIndexBound=t.tipStart-3,this.tongueIndexCentre=.5*(this.tongueLowerIndexBound+this.tongueUpperIndexBound)}},{key:"getIndex",value:function(t,e){for(var n=this.trombone.Tract,i=t-this.originX,r=e-this.originY,o=Math.atan2(r,i);o>0;)o-=2*Math.PI;return(Math.PI+o-this.angleOffset)*(n.lipStart-1)/(this.angleScale*Math.PI)}},{key:"getDiameter",value:function(t,e){var n=t-this.originX,i=e-this.originY;return(this.radius-Math.sqrt(n*n+i*i))/this.scale}},{key:"setRestDiameter",value:function(){for(var t=this.trombone.Tract,e=t.bladeStart;e<t.lipStart;e++){var n=1.1*Math.PI*(this.tongueIndex-e)/(t.tipStart-t.bladeStart),i=2+(this.tongueDiameter-2)/1.5,r=(1.5-i+this.gridOffset)*Math.cos(n);e!=t.bladeStart-2&&e!=t.lipStart-1||(r*=.8),e!=t.bladeStart&&e!=t.lipStart-2||(r*=.94),t.restDiameter[e]=1.5-r}}},{key:"SetLipsClosed",value:function(t){var e=this.trombone.Tract;this.setRestDiameter();for(var n=0;n<e.n;n++)e.targetDiameter[n]=e.restDiameter[n];for(var i=this.index-this.radius;i<=this.index+this.radius;i++)if(!(i>e.targetDiameter.length||i<0)){var r=Math.lerp(e.restDiameter[i],this.target,t);e.targetDiameter[i]=r}}}]),t}();n.TractUI=o},{}],9:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.trombone=e,this.n=44,this.bladeStart=10,this.tipStart=32,this.lipStart=39,this.R=[],this.L=[],this.reflection=[],this.junctionOutputR=[],this.junctionOutputL=[],this.maxAmplitude=[],this.diameter=[],this.restDiameter=[],this.targetDiameter=[],this.newDiameter=[],this.A=[],this.glottalReflection=.75,this.lipReflection=-.85,this.lastObstruction=-1,this.fade=1,this.movementSpeed=15,this.transients=[],this.lipOutput=0,this.noseOutput=0,this.velumTarget=.01}return r(t,[{key:"init",value:function(){this.bladeStart=Math.floor(this.bladeStart*this.n/44),this.tipStart=Math.floor(this.tipStart*this.n/44),this.lipStart=Math.floor(this.lipStart*this.n/44),this.diameter=new Float64Array(this.n),this.restDiameter=new Float64Array(this.n),this.targetDiameter=new Float64Array(this.n),this.newDiameter=new Float64Array(this.n);for(var t=0;t<this.n;t++){var e=0;e=t<7*this.n/44-.5?.6:t<12*this.n/44?1.1:1.5,this.diameter[t]=this.restDiameter[t]=this.targetDiameter[t]=this.newDiameter[t]=e}this.R=new Float64Array(this.n),this.L=new Float64Array(this.n),this.reflection=new Float64Array(this.n+1),this.newReflection=new Float64Array(this.n+1),this.junctionOutputR=new Float64Array(this.n+1),this.junctionOutputL=new Float64Array(this.n+1),this.A=new Float64Array(this.n),this.maxAmplitude=new Float64Array(this.n),this.noseLength=Math.floor(28*this.n/44),this.noseStart=this.n-this.noseLength+1,this.noseR=new Float64Array(this.noseLength),this.noseL=new Float64Array(this.noseLength),this.noseJunctionOutputR=new Float64Array(this.noseLength+1),this.noseJunctionOutputL=new Float64Array(this.noseLength+1),this.noseReflection=new Float64Array(this.noseLength+1),this.noseDiameter=new Float64Array(this.noseLength),this.noseA=new Float64Array(this.noseLength),this.noseMaxAmplitude=new Float64Array(this.noseLength);for(var t=0;t<this.noseLength;t++){var e,n=t/this.noseLength*2;e=n<1?.4+1.6*n:.5+1.5*(2-n),e=Math.min(e,1.9),this.noseDiameter[t]=e}this.newReflectionLeft=this.newReflectionRight=this.newReflectionNose=0,this.calculateReflections(),this.calculateNoseReflections(),this.noseDiameter[0]=this.velumTarget}},{key:"reshapeTract",value:function(t){for(var e=t*this.movementSpeed,n=-1,i=0;i<this.n;i++){var r=this.diameter[i],o=this.targetDiameter[i];r<=0&&(n=i);var s;s=i<this.noseStart?.6:i>=this.tipStart?1:.6+.4*(i-this.noseStart)/(this.tipStart-this.noseStart),this.diameter[i]=Math.moveTowards(r,o,s*e,2*e)}this.lastObstruction>-1&&-1==n&&this.noseA[0]<.05&&this.addTransient(this.lastObstruction),this.lastObstruction=n,e=t*this.movementSpeed,this.noseDiameter[0]=Math.moveTowards(this.noseDiameter[0],this.velumTarget,.25*e,.1*e),this.noseA[0]=this.noseDiameter[0]*this.noseDiameter[0]}},{key:"calculateReflections",value:function(){for(var t=0;t<this.n;t++)this.A[t]=this.diameter[t]*this.diameter[t];for(var t=1;t<this.n;t++)this.reflection[t]=this.newReflection[t],0==this.A[t]?this.newReflection[t]=.999:this.newReflection[t]=(this.A[t-1]-this.A[t])/(this.A[t-1]+this.A[t]);this.reflectionLeft=this.newReflectionLeft,this.reflectionRight=this.newReflectionRight,this.reflectionNose=this.newReflectionNose;var e=this.A[this.noseStart]+this.A[this.noseStart+1]+this.noseA[0];this.newReflectionLeft=(2*this.A[this.noseStart]-e)/e,this.newReflectionRight=(2*this.A[this.noseStart+1]-e)/e,this.newReflectionNose=(2*this.noseA[0]-e)/e}},{key:"calculateNoseReflections",value:function(){for(var t=0;t<this.noseLength;t++)this.noseA[t]=this.noseDiameter[t]*this.noseDiameter[t];for(var t=1;t<this.noseLength;t++)this.noseReflection[t]=(this.noseA[t-1]-this.noseA[t])/(this.noseA[t-1]+this.noseA[t])}},{key:"runStep",value:function(t,e,n){var i=Math.random()<.1;this.processTransients(),this.addTurbulenceNoise(e),this.junctionOutputR[0]=this.L[0]*this.glottalReflection+t,this.junctionOutputL[this.n]=this.R[this.n-1]*this.lipReflection;for(var r=1;r<this.n;r++){var o=this.reflection[r]*(1-n)+this.newReflection[r]*n,s=o*(this.R[r-1]+this.L[r]);this.junctionOutputR[r]=this.R[r-1]-s,this.junctionOutputL[r]=this.L[r]+s}var r=this.noseStart,o=this.newReflectionLeft*(1-n)+this.reflectionLeft*n;this.junctionOutputL[r]=o*this.R[r-1]+(1+o)*(this.noseL[0]+this.L[r]),o=this.newReflectionRight*(1-n)+this.reflectionRight*n,this.junctionOutputR[r]=o*this.L[r]+(1+o)*(this.R[r-1]+this.noseL[0]),o=this.newReflectionNose*(1-n)+this.reflectionNose*n,this.noseJunctionOutputR[0]=o*this.noseL[0]+(1+o)*(this.L[r]+this.R[r-1]);for(var r=0;r<this.n;r++)if(this.R[r]=.999*this.junctionOutputR[r],this.L[r]=.999*this.junctionOutputL[r+1],i){var a=Math.abs(this.R[r]+this.L[r]);a>this.maxAmplitude[r]?this.maxAmplitude[r]=a:this.maxAmplitude[r]*=.999}this.lipOutput=this.R[this.n-1],this.noseJunctionOutputL[this.noseLength]=this.noseR[this.noseLength-1]*this.lipReflection;for(var r=1;r<this.noseLength;r++){var s=this.noseReflection[r]*(this.noseR[r-1]+this.noseL[r]);this.noseJunctionOutputR[r]=this.noseR[r-1]-s,this.noseJunctionOutputL[r]=this.noseL[r]+s}for(var r=0;r<this.noseLength;r++)if(this.noseR[r]=this.noseJunctionOutputR[r]*this.fade,this.noseL[r]=this.noseJunctionOutputL[r+1]*this.fade,i){var a=Math.abs(this.noseR[r]+this.noseL[r]);a>this.noseMaxAmplitude[r]?this.noseMaxAmplitude[r]=a:this.noseMaxAmplitude[r]*=.999}this.noseOutput=this.noseR[this.noseLength-1]}},{key:"finishBlock",value:function(){this.reshapeTract(this.trombone.AudioSystem.blockTime),this.calculateReflections()}},{key:"addTransient",value:function(t){var e={};e.position=t,e.timeAlive=0,e.lifeTime=.2,e.strength=.3,e.exponent=200,this.transients.push(e)}},{key:"processTransients",value:function(){for(var t=0;t<this.transients.length;t++){var e=this.transients[t],n=e.strength*Math.pow(2,-e.exponent*e.timeAlive);this.R[e.position]+=n/2,this.L[e.position]+=n/2,e.timeAlive+=1/(2*this.trombone.sampleRate)}for(var t=this.transients.length-1;t>=0;t--){var e=this.transients[t];e.timeAlive>e.lifeTime&&this.transients.splice(t,1)}}},{key:"addTurbulenceNoise",value:function(t){}},{key:"addTurbulenceNoiseAtIndex",value:function(t,e,n){var i=Math.floor(e),r=e-i;t*=this.trombone.Glottis.getNoiseModulator();var o=Math.clamp(8*(.7-n),0,1),s=Math.clamp(30*(n-.3),0,1),a=t*(1-r)*o*s,u=t*r*o*s;this.R[i+1]+=a/2,this.L[i+1]+=a/2,this.R[i+2]+=u/2,this.L[i+2]+=u/2}}]),t}();n.Tract=o},{}],10:[function(t,e,n){"use strict";Math.clamp=function(t,e,n){return t<e?e:t>n?n:t},Math.moveTowards=function(t,e,n){return t<e?Math.min(t+n,e):Math.max(t-n,e)},Math.moveTowards=function(t,e,n,i){return t<e?Math.min(t+n,e):Math.max(t-i,e)},Math.gaussian=function(){for(var t=0,e=0;e<16;e++)t+=Math.random();return(t-8)/4},Math.lerp=function(t,e,n){return t+(e-t)*n}},{}],11:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e,n,r){i(this,t),this.x=e,this.y=n,this.z=r}return r(t,[{key:"dot2",value:function(t,e){return this.x*t+this.y*e}},{key:"dot3",value:function(t,e,n){return this.x*t+this.y*e+this.z*n}}]),t}(),s=function(){function t(){i(this,t),this.grad3=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(Date.now())}return r(t,[{key:"seed",value:function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var n;n=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=n,this.gradP[e]=this.gradP[e+256]=this.grad3[n%12]}}},{key:"simplex2",value:function(t,e){var n,i,r,o,s,a=.5*(Math.sqrt(3)-1),u=(3-Math.sqrt(3))/6,h=(t+e)*a,c=Math.floor(t+h),l=Math.floor(e+h),f=(c+l)*u,d=t-c+f,p=e-l+f;d>p?(o=1,s=0):(o=0,s=1);var m=d-o+u,v=p-s+u,y=d-1+2*u,b=p-1+2*u;c&=255,l&=255;var g=this.gradP[c+this.perm[l]],w=this.gradP[c+o+this.perm[l+s]],k=this.gradP[c+1+this.perm[l+1]],T=.5-d*d-p*p;T<0?n=0:(T*=T,n=T*T*g.dot2(d,p));var M=.5-m*m-v*v;M<0?i=0:(M*=M,i=M*M*w.dot2(m,v));var O=.5-y*y-b*b;return O<0?r=0:(O*=O,r=O*O*k.dot2(y,b)),70*(n+i+r)}},{key:"simplex1",value:function(t){return this.simplex2(1.2*t,.7*-t)}}]),t}(),a=new s;Object.freeze(a),n.default=a},{}],12:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PinkTrombone=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();t("./math-extensions.js");var o=t("./components/audio-system.js"),s=t("./components/glottis.js"),a=t("./components/tract.js"),u=t("./components/tract-ui.js"),h=function(){function t(){i(this,t),this.sampleRate=0,this.time=0,this.alwaysVoice=!0,this.autoWobble=!0,this.noiseFreq=500,this.noiseQ=.7,this.AudioSystem=new o.AudioSystem(this),this.AudioSystem.init(),this.Glottis=new s.Glottis(this),this.Glottis.init(),this.Tract=new a.Tract(this),this.Tract.init(),this.TractUI=new u.TractUI(this),this.TractUI.init()}return r(t,[{key:"StartAudio",value:function(){this.muted=!1,this.AudioSystem.startSound()}},{key:"SetMute",value:function(t){t?this.AudioSystem.mute():this.AudioSystem.unmute(),this.muted=t}},{key:"ToggleMute",value:function(){this.SetMute(!this.muted)}}]),t}();n.PinkTrombone=h},{"./components/audio-system.js":6,"./components/glottis.js":7,"./components/tract-ui.js":8,"./components/tract.js":9,"./math-extensions.js":10}],13:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){i(this,t)}return r(t,null,[{key:"LoadOBJ",value:function(t,e){var n=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100
;console.log(Math.round(e,2)+"% downloaded")}},i=function(t){},r=new THREE.MTLLoader;r.setPath(t.path),r.load(t.mtlFile,function(r){r.preload();var o=new THREE.OBJLoader;o.setMaterials(r),o.setPath(t.path),o.load(t.objFile,function(t){e(t)},n,i)})}},{key:"LoadJSON",value:function(t,e){var n=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},i=function(t){};(new THREE.JSONLoader).load(t,function(t,n){var i=!0,r=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0)s.value.skinning=!0}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}var u=new THREE.SkinnedMesh(t,new THREE.MultiMaterial(n));u.name="Jon",e(u)},n,i)}},{key:"LoadFBX",value:function(t,e){var n=new THREE.LoadingManager;n.onProgress=function(t,e,n){console.log(t,e,n)};var i=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},r=function(t){};new THREE.FBXLoader(n).load(t,function(t){e(t)},i,r)}}]),t}();n.ModelLoader=o},{}],14:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){i(this,t)}return r(t,null,[{key:"HasWebGL",value:function(){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),e=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,i=0;i<4;i++)try{if((n=t.getContext(e[i]))&&"function"==typeof n.getParameter)return!0}catch(t){}return!1}return!1}},{key:"GetErrorHTML",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t&&(t='Your graphics card does not seem to support \n                        <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>. <br>\n                        Find out how to get it <a href="http://get.webgl.org/">here</a>.'),'\n        <div class="no-webgl-support">\n        <p style="text-align: center;">'+t+"</p>\n        </div>\n        "}}]),t}();n.Detector=o},{}],15:[function(t,e,n){!function(t,i){"object"==typeof n&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof n?n.MidiConvert=i():t.MidiConvert=i()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=n(2),o={instrumentByPatchID:r.instrumentByPatchID,instrumentFamilyByID:r.instrumentFamilyByID,parse:function(t){return(new i.Midi).decode(t)},load:function(t,e){var n=(new i.Midi).load(t);return e&&n.then(e),n},create:function(){return new i.Midi}};e.default=o,t.exports=o},function(t,e){"use strict";function n(t){return t.replace(/\u0000/g,"")}function i(t,e){return 60/e.bpm*(t/e.PPQ)}function r(t){return"number"==typeof t}function o(t){return"string"==typeof t}function s(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]+(Math.floor(t/12)-1)}var a=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;return function(e){return o(e)&&t.test(e)}}(),u=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var i=t.exec(n),r=i[1],o=i[2];return e[r.toLowerCase()]+12*(parseInt(o)+1)}}();t.exports={cleanName:n,ticksToSeconds:i,isString:o,isNumber:r,isPitch:a,midiToPitch:s,pitchToMidi:u}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.instrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"]},function(t,e){"use strict";function n(t,e){var n=0,i=t.length,r=i;if(i>0&&t[i-1].time<=e)return i-1;for(;r>n;){var o=Math.floor(n+(r-n)/2),s=t[o],a=t[o+1];if(s.time===e){for(var u=o;u<t.length;u++){t[u].time===e&&(o=u)}return o}if(s.time<e&&a.time>e)return o;s.time>e?r=o:s.time<e&&(n=o+1)}return-1}function i(t,e){if(t.length){var i=n(t,e.time);t.splice(i+1,0,e)}else t.push(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.BinaryInsert=i},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"},o=function(){function t(e,i,r){n(this,t),this.number=e,this.time=i,this.value=r}return i(t,[{key:"name",get:function(){return r.hasOwnProperty(this.number)?r[this.number]:void 0}}]),t}();e.Control=o},function(t,e){"use strict";function n(t){for(var e={PPQ:t.header.ticksPerBeat},n=0;n<t.tracks.length;n++)for(var i=t.tracks[n],r=0;r<i.length;r++){var o=i[r];"meta"===o.type&&("timeSignature"===o.subtype?e.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(e.bpm||(e.bpm=6e7/o.microsecondsPerBeat)))}return e.bpm=e.bpm||120,e}Object.defineProperty(e,"__esModule",{value:!0}),e.parseHeader=n},function(t,e){"use strict";function n(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[n];if(i.length>r)return!0}return!1}function i(t,e,n){for(var i=0,r=1/0,o=0;o<t.length;o++){var s=t[o],a=e[o];s[a]&&s[a].time<r&&(i=o,r=s[a].time)}n[i](t[i][e[i]]),e[i]+=1}function r(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];for(var o=e.filter(function(t,e){return e%2==0}),s=new Uint32Array(o.length),a=e.filter(function(t,e){return e%2==1});n(o,s);)i(o,s,a)}Object.defineProperty(e,"__esModule",{value:!0}),e.Merge=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Midi=void 0;var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(11),a=i(s),u=n(10),h=i(u),c=n(1),l=i(c),f=n(9),d=n(5),p=function(){function t(){r(this,t),this.header={bpm:120,timeSignature:[4,4],PPQ:480},this.tracks=[]}return o(t,[{key:"load",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise(function(r,o){var s=new XMLHttpRequest;s.open(i,t),s.responseType="arraybuffer",s.addEventListener("load",function(){4===s.readyState&&200===s.status?r(e.decode(s.response)):o(s.status)}),s.addEventListener("error",o),s.send(n)})}},{key:"decode",value:function(t){var e=this;if(t instanceof ArrayBuffer){var n=new Uint8Array(t);t=String.fromCharCode.apply(null,n)}var i=(0,a.default)(t);return this.header=(0,d.parseHeader)(i),this.tracks=[],i.tracks.forEach(function(t){var n=new f.Track;e.tracks.push(n);var i=0;t.forEach(function(t){i+=l.default.ticksToSeconds(t.deltaTime,e.header),"meta"===t.type&&"trackName"===t.subtype?n.name=l.default.cleanName(t.text):"noteOn"===t.subtype?n.noteOn(t.noteNumber,i,t.velocity/127):"noteOff"===t.subtype?n.noteOff(t.noteNumber,i):"controller"===t.subtype&&t.controllerType?n.cc(t.controllerType,i,t.value/127):"meta"===t.type&&"instrumentName"===t.subtype?n.instrument=t.text:"channel"===t.type&&"programChange"===t.subtype&&n.patch(t.programNumber)})}),this}},{key:"encode",value:function(){var t=this,e=new h.default.File({ticks:this.header.PPQ});return this.tracks.forEach(function(n,i){var r=e.addTrack();r.setTempo(t.bpm),n.encode(r,t.header)}),e.toBytes()}},{key:"toArray",value:function(){for(var t=this.encode(),e=new Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}},{key:"track",value:function(t){var e=new f.Track(t);return this.tracks.push(e),e}},{key:"get",value:function(t){return l.default.isNumber(t)?this.tracks[t]:this.tracks.find(function(e){return e.name===t})}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,i=new t;return i.header=this.header,i.tracks=this.tracks.map(function(t){return t.slice(e,n)}),i}},{key:"startTime",get:function(){var t=this.tracks.map(function(t){return t.startTime});return Math.min.apply(Math,t)}},{key:"bpm",get:function(){return this.header.bpm},set:function(t){var e=this.header.bpm;this.header.bpm=t;var n=e/t;this.tracks.forEach(function(t){return t.scale(n)})}},{key:"timeSignature",get:function(){return this.header.timeSignature},set:function(t){this.header.timeSignature=timeSignature}},{key:"duration",get:function(){var t=this.tracks.map(function(t){return t.duration});return Math.max.apply(Math,t)}}]),t}();e.Midi=p},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Note=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(1),s=function(t){return t&&t.__esModule?t:{default:t}}(o),a=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(i(this,t),this.midi,s.default.isNumber(e))this.midi=e;else{if(!s.default.isPitch(e))throw new Error("the midi value must either be in Pitch Notation (e.g. C#4) or a midi value");this.name=e}this.time=n,this.duration=r,this.velocity=o}return r(t,[{key:"match",value:function(t){return s.default.isNumber(t)?this.midi===t:s.default.isPitch(t)?this.name.toLowerCase()===t.toLowerCase():void 0}},{key:"toJSON",value:function(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration}}},{key:"name",get:function(){return s.default.midiToPitch(this.midi)},set:function(t){this.midi=s.default.pitchToMidi(t)}},{key:"noteOn",get:function(){return this.time},set:function(t){this.time=t}},{key:"noteOff",get:function(){return this.time+this.duration},set:function(t){this.duration=t-this.time}}]),t}();e.Note=a},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(3),s=n(4),a=n(6),u=n(8),h=n(2),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;i(this,t),this.name=e,this.notes=[],this.controlChanges={},this.instrumentNumber=n}return r(t,[{key:"note",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=new u.Note(t,e,n,i);return(0,o.BinaryInsert)(this.notes,r),this}},{key:"noteOn",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=new u.Note(t,e,0,n);return(0,o.BinaryInsert)(this.notes,i),this}},{key:"noteOff",value:function(t,e){for(var n=0;n<this.notes.length;n++){var i=this.notes[n];if(i.match(t)&&0===i.duration){i.noteOff=e;break}}return this}},{key:"cc",value:function(t,e,n){this.controlChanges.hasOwnProperty(t)||(this.controlChanges[t]=[]);var i=new s.Control(t,e,n);return(0,o.BinaryInsert)(this.controlChanges[t],i),this}},{key:"patch",value:function(t){return this.instrumentNumber=t,this}},{key:"scale",value:function(t){return this.notes.forEach(function(e){e.time*=t,e.duration*=t}),this}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,i=Math.max(this.notes.findIndex(function(t){return t.time>=e}),0),r=this.notes.findIndex(function(t){return t.noteOff>=n})+1,o=new t(this.name);return o.notes=this.notes.slice(i,r),o.notes.forEach(function(t){return t.time=t.time-e}),o}},{key:"encode",value:function(t,e){function n(t){var e=Math.floor(i*t),n=Math.max(e-r,0);return r=e,n}var i=e.PPQ/(60/e.bpm),r=0;-1!==this.instrumentNumber&&t.instrument(0,this.instrumentNumber),(0,a.Merge)(this.noteOns,function(e){t.addNoteOn(0,e.name,n(e.time),Math.floor(127*e.velocity))},this.noteOffs,function(e){t.addNoteOff(0,e.name,n(e.time))})}},{key:"noteOns",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOn,midi:e.midi,name:e.name,velocity:e.velocity})}),t}},{key:"noteOffs",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOff,midi:e.midi,name:e.name})}),t}},{key:"length",get:function(){return this.notes.length}},{key:"startTime",get:function(){if(this.notes.length){return this.notes[0].noteOn}return 0}},{key:"duration",get:function(){if(this.notes.length){return this.notes[this.notes.length-1].noteOff}return 0}},{key:"instrument",get:function(){return h.instrumentByPatchID[this.instrumentNumber]},set:function(t){var e=h.instrumentByPatchID.indexOf(t);-1!==e&&(this.instrumentNumber=e)}},{key:"instrumentFamily",get:function(){return h.instrumentFamilyByID[Math.floor(this.instrumentNumber/8)]}}]),t}();e.Track=c},function(t,e,n){(function(t){var n={};!function(t){var e=t.DEFAULT_VOLUME=90,n=(t.DEFAULT_DURATION=128,t.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(t){var e=/([a-g])(#+|b+)?([0-9]+)$/i.exec(t),i=e[1].toLowerCase(),r=e[2]||"";return 12*parseInt(e[3],10)+n.midi_letter_pitches[i]+("#"==r.substr(0,1)?1:-1)*r.length},ensureMidiPitch:function(t){return"number"!=typeof t&&/[^0-9]/.test(t)?n.midiPitchFromNote(t):parseInt(t,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(t,e){var i,r=0,o=t,e=e||!1;return t>23&&(r=Math.floor(t/12)-1,o=t-12*r),i=n.midi_pitches_letter[o],e&&i.indexOf("#")>0&&(i=n.midi_flattened_notes[i]),i+r},mpqnFromBpm:function(t){var e=Math.floor(6e7/t),n=[];do{n.unshift(255&e),e>>=8}while(e);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(t){var e=t;if(void 0!==t[0]){e=0;for(var n=0,i=t.length-1;i>=0;++n,--i)e|=t[n]<<i}return Math.floor(6e7/t)},codes2Str:function(t){return String.fromCharCode.apply(null,t)},str2Bytes:function(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],i=t.length-1;i>=0;i-=2){var r=0===i?t[i]:t[i-1]+t[i];n.unshift(parseInt(r,16))}return n},translateTickTime:function(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];n.push(255&e),128&e;)e>>=8;return n}}),i=function(t){return this?void(!t||null===t.type&&void 0===t.type||null===t.channel&&void 0===t.channel||null===t.param1&&void 0===t.param1||(this.setTime(t.time),this.setType(t.type),this.setChannel(t.channel),this.setParam1(t.param1),this.setParam2(t.param2))):new i(t)};i.NOTE_OFF=128,i.NOTE_ON=144,i.AFTER_TOUCH=160,i.CONTROLLER=176,i.PROGRAM_CHANGE=192,i.CHANNEL_AFTERTOUCH=208,i.PITCH_BEND=224,i.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},i.prototype.setType=function(t){if(t<i.NOTE_OFF||t>i.PITCH_BEND)throw new Error("Trying to set an unknown event: "+t);this.type=t},i.prototype.setChannel=function(t){if(0>t||t>15)throw new Error("Channel is out of bounds.");this.channel=t},i.prototype.setParam1=function(t){this.param1=t},i.prototype.setParam2=function(t){this.param2=t},i.prototype.toBytes=function(){var t=[],e=this.type|15&this.channel;return t.push.apply(t,this.time),t.push(e),t.push(this.param1),void 0!==this.param2&&null!==this.param2&&t.push(this.param2),t};var r=function(t){if(!this)return new r(t);this.setTime(t.time),this.setType(t.type),this.setData(t.data)};r.SEQUENCE=0,r.TEXT=1,r.COPYRIGHT=2,r.TRACK_NAME=3,r.INSTRUMENT=4,r.LYRIC=5,r.MARKER=6,r.CUE_POINT=7,r.CHANNEL_PREFIX=32,r.END_OF_TRACK=47,r.TEMPO=81,r.SMPTE=84,r.TIME_SIG=88,r.KEY_SIG=89,r.SEQ_EVENT=127,r.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},r.prototype.setType=function(t){this.type=t},r.prototype.setData=function(t){this.data=t},r.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var t=[];if(t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data))t.push(this.data.length),t.push.apply(t,this.data);else if("number"==typeof this.data)t.push(1,this.data);else if(null!==this.data&&void 0!==this.data){t.push(this.data.length);var e=this.data.split("").map(function(t){return t.charCodeAt(0)});t.push.apply(t,e)}else t.push(0);return t};var o=function(t){if(!this)return new o(t);var e=t||{};this.events=e.events||[]};o.START_BYTES=[77,84,114,107],o.END_BYTES=[0,255,47,0],o.prototype.addEvent=function(t){return this.events.push(t),this},o.prototype.addNoteOn=o.prototype.noteOn=function(t,r,o,s){return this.events.push(new i({type:i.NOTE_ON,channel:t,param1:n.ensureMidiPitch(r),param2:s||e,time:o||0})),this},o.prototype.addNoteOff=o.prototype.noteOff=function(t,r,o,s){return this.events.push(new i({type:i.NOTE_OFF,channel:t,param1:n.ensureMidiPitch(r),param2:s||e,time:o||0})),this},o.prototype.addNote=o.prototype.note=function(t,e,n,i,r){return this.noteOn(t,e,i,r),n&&this.noteOff(t,e,n,r),this},o.prototype.addChord=o.prototype.chord=function(t,e,n,i){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach(function(e){this.noteOn(t,e,0,i)},this),e.forEach(function(e,i){0===i?this.noteOff(t,e,n):this.noteOff(t,e)},this),this},o.prototype.setInstrument=o.prototype.instrument=function(t,e,n){return this.events.push(new i({type:i.PROGRAM_CHANGE,channel:t,param1:e,time:n||0})),this},o.prototype.setTempo=o.prototype.tempo=function(t,e){return this.events.push(new r({type:r.TEMPO,data:n.mpqnFromBpm(t),time:e||0})),this},o.prototype.toBytes=function(){var t=0,e=[],i=o.START_BYTES,r=o.END_BYTES,s=function(n){var i=n.toBytes();t+=i.length,e.push.apply(e,i)};this.events.forEach(s),t+=r.length;var a=n.str2Bytes(t.toString(16),4);return i.concat(a,e,r)};var s=function(t){if(!this)return new s(t);var e=t||{};if(e.ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||e.ticks>=32768||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]};s.HDR_CHUNKID="MThd",s.HDR_CHUNK_SIZE="\0\0\0",s.HDR_TYPE0="\0\0",s.HDR_TYPE1="\0",s.prototype.addTrack=function(t){return t?(this.tracks.push(t),this):(t=new o,this.tracks.push(t),t)},s.prototype.toBytes=function(){var t=this.tracks.length.toString(16),e=s.HDR_CHUNKID+s.HDR_CHUNK_SIZE;return e+=parseInt(t,16)>1?s.HDR_TYPE1:s.HDR_TYPE0,e+=n.codes2Str(n.str2Bytes(t,2)),e+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach(function(t){e+=n.codes2Str(t.toBytes())}),e},t.Util=n,t.File=s,t.Track=o,t.Event=i,t.MetaEvent=r}(n),void 0!==t&&null!==t?t.exports=n:void 0!==e&&null!==e?e=n:this.Midi=n}).call(e,n(12)(t))},function(t,e){function n(t){function e(t){var e=t.read(4),n=t.readInt32();return{id:e,length:n,data:t.read(n)}}var n;stream=i(t);var r=e(stream);if("MThd"!=r.id||6!=r.length)throw"Bad .mid file - header not found";var o=i(r.data),s=o.readInt16(),a=o.readInt16(),u=o.readInt16();if(32768&u)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=u;for(var h={formatType:s,trackCount:a,ticksPerBeat:ticksPerBeat},c=[],l=0;l<h.trackCount;l++){c[l]=[];var f=e(stream);if("MTrk"!=f.id)throw"Unexpected chunk - expected MTrk, got "+f.id;for(var d=i(f.data);!d.eof();){var p=function(t){var e={};e.deltaTime=t.readVarInt();var i=t.readInt8();if(240==(240&i)){if(255==i){e.type="meta";var r=t.readInt8(),o=t.readVarInt();switch(r){case 0:if(e.subtype="sequenceNumber",2!=o)throw"Expected length for sequenceNumber event is 2, got "+o;return e.number=t.readInt16(),e;case 1:return e.subtype="text",e.text=t.read(o),e;case 2:return e.subtype="copyrightNotice",e.text=t.read(o),e;case 3:return e.subtype="trackName",e.text=t.read(o),e;case 4:return e.subtype="instrumentName",e.text=t.read(o),e;case 5:return e.subtype="lyrics",e.text=t.read(o),e;case 6:return e.subtype="marker",e.text=t.read(o),e;case 7:return e.subtype="cuePoint",e.text=t.read(o),e;case 32:if(e.subtype="midiChannelPrefix",1!=o)throw"Expected length for midiChannelPrefix event is 1, got "+o;return e.channel=t.readInt8(),e;case 47:if(e.subtype="endOfTrack",0!=o)throw"Expected length for endOfTrack event is 0, got "+o;return e;case 81:if(e.subtype="setTempo",3!=o)throw"Expected length for setTempo event is 3, got "+o;return e.microsecondsPerBeat=(t.readInt8()<<16)+(t.readInt8()<<8)+t.readInt8(),e;case 84:if(e.subtype="smpteOffset",5!=o)throw"Expected length for smpteOffset event is 5, got "+o;var s=t.readInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&s],e.hour=31&s,e.min=t.readInt8(),e.sec=t.readInt8(),e.frame=t.readInt8(),e.subframe=t.readInt8(),e;case 88:if(e.subtype="timeSignature",4!=o)throw"Expected length for timeSignature event is 4, got "+o;return e.numerator=t.readInt8(),e.denominator=Math.pow(2,t.readInt8()),e.metronome=t.readInt8(),e.thirtyseconds=t.readInt8(),e;case 89:if(e.subtype="keySignature",2!=o)throw"Expected length for keySignature event is 2, got "+o;return e.key=t.readInt8(!0),e.scale=t.readInt8(),e;case 127:return e.subtype="sequencerSpecific",e.data=t.read(o),e;default:return e.subtype="unknown",e.data=t.read(o),e}return e.data=t.read(o),e}if(240==i){e.type="sysEx";var o=t.readVarInt();return e.data=t.read(o),e}if(247==i){e.type="dividedSysEx";var o=t.readVarInt();return e.data=t.read(o),e}throw"Unrecognised MIDI event type byte: "+i}var a;0==(128&i)?(a=i,i=n):(a=t.readInt8(),n=i);var u=i>>4;switch(e.channel=15&i,e.type="channel",u){case 8:return e.subtype="noteOff",e.noteNumber=a,e.velocity=t.readInt8(),e;case 9:return e.noteNumber=a,e.velocity=t.readInt8(),0==e.velocity?e.subtype="noteOff":e.subtype="noteOn",e;case 10:return e.subtype="noteAftertouch",e.noteNumber=a,e.amount=t.readInt8(),e;case 11:return e.subtype="controller",e.controllerType=a,e.value=t.readInt8(),e;case 12:return e.subtype="programChange",e.programNumber=a,e;case 13:return e.subtype="channelAftertouch",e.amount=a,e;case 14:return e.subtype="pitchBend",e.value=a+(t.readInt8()<<7),e;default:throw"Unrecognised MIDI event type: "+u}}(d);c[l].push(p)}}return{header:h,tracks:c}}function i(t){function e(e){var n=t.substr(a,e);return a+=e,n}function n(){var e=(t.charCodeAt(a)<<24)+(t.charCodeAt(a+1)<<16)+(t.charCodeAt(a+2)<<8)+t.charCodeAt(a+3);return a+=4,e}function i(){var e=(t.charCodeAt(a)<<8)+t.charCodeAt(a+1);return a+=2,e}function r(e){var n=t.charCodeAt(a);return e&&n>127&&(n-=256),a+=1,n}function o(){return a>=t.length}function s(){for(var t=0;;){var e=r();if(!(128&e))return t+e;t+=127&e,t<<=7}}var a=0;return{eof:o,read:e,readInt32:n,readInt16:i,readInt8:r,readVarInt:s}}t.exports=function(t){return n(t)}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}])})},{}]},{},[3]);
//# sourceMappingURL=jon-trombone.min.js.map
