!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return s(i||t)},l,l.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.JonTrombone=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=t("./utils/model-loader.js"),r=t("./pink-trombone/pink-trombone.js"),a=function(){function t(e){var i=this;n(this,t),this.container=e,this.container.style.position="relative",this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.setClearColor(0,0),this.container.appendChild(this.renderer.domElement);var s=this.container.offsetWidth/this.container.offsetHeight;this.camera=new THREE.PerspectiveCamera(45,s,.1,100),this.scene=new THREE.Scene,this.clock=new THREE.Clock;this.trombone=new r.PinkTrombone,setTimeout(function(){i.trombone.StartAudio(),i.moveJaw=!0},1e3);var o=document.createElement("button");o.innerHTML="Mute",o.style.cssText="position: absolute; display: block; top: 0; left: 0;",this.container.appendChild(o),o.addEventListener("click",function(){i.trombone.ToggleMute(),o.innerHTML=i.trombone.muted?"Unmute":"Mute"}),this.jawFlapSpeed=20,this.jawOpenOffset=.19,this.moveJaw=!1,this.SetUpThree(),this.SetUpScene(),this.OnUpdate()}return s(t,[{key:"SetUpThree",value:function(){this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.target.set(0,0,0),this.controls.update()}},{key:"SetUpScene",value:function(){var t=this;this.camera.position.set(0,0,.5);var e=new THREE.HemisphereLight(16777215,4473924,1);e.name="Hemisphere Light",e.position.set(0,1,0),this.scene.add(e);var i=new THREE.DirectionalLight(16777215,1);i.name="Directional Light",i.position.set(0,1,0),this.scene.add(i),o.ModelLoader.LoadJSON("../resources/jon/three/jon.json",function(e){t.jon=e,t.scene.add(t.jon),t.jon.rotation.y=THREE.Math.degToRad(15),t.jaw=t.jon.skeleton.bones.find(function(t){return"Bone.006"==t.name}),t.jaw&&(t.jawShutZ=t.jaw.position.z)})}},{key:"OnUpdate",value:function(){this.clock.getDelta();if(requestAnimationFrame(this.OnUpdate.bind(this)),this.jaw&&this.moveJaw){var t=this.clock.getElapsedTime(),e=(Math.sin(t*this.jawFlapSpeed)+1)/2;this.jaw.position.z=this.jawShutZ+e*this.jawOpenOffset,this.trombone.TractUI.Buh(1-e)}this.renderer.render(this.scene,this.camera)}}]),t}();i.JonTrombone=a},{"./pink-trombone/pink-trombone.js":9,"./utils/model-loader.js":10}],2:[function(t,e,i){"use strict";var n=t("./utils/webgl-detect.js"),s=t("./jon-trombone.js"),o=document.getElementById("jon-trombone-container");n.Detector.HasWebGL()?(window.jonTrombone=new s.JonTrombone(o),function(){if("undefined"==typeof dat)return void console.log("No DAT.GUI instance found. Import on the page to use!");var t=new dat.GUI({}),e=window.jonTrombone;t.add(e.trombone,"ToggleMute");var i=t.addFolder("Jon");i.add(e,"moveJaw"),i.add(e,"jawFlapSpeed").min(0).max(100),i.add(e,"jawOpenOffset").min(0).max(1);var n=t.addFolder("Voice");n.add(e.trombone,"autoWobble"),n.add(e.trombone.AudioSystem,"useWhiteNoise"),n.add(e.trombone.Glottis,"UITenseness").min(0).max(1),n.add(e.trombone.Glottis,"vibratoAmount").min(0).max(.5),n.add(e.trombone.Glottis,"UIFrequency").min(1).max(1e3),n.add(e.trombone.Glottis,"loudness").min(0).max(1);var s=t.addFolder("Tract");s.add(e.trombone.Tract,"movementSpeed").min(1).max(30).step(1),s.add(e.trombone.TractUI,"target").min(.001).max(1),s.add(e.trombone.TractUI,"index").min(0).max(43).step(1),s.add(e.trombone.TractUI,"radius").min(0).max(5).step(1)}()):(console.log("WebGL is not supported on this browser."),o.innerHTML=n.Detector.GetErrorHTML(),o.classList.add("no-webgl"))},{"./jon-trombone.js":1,"./utils/webgl-detect.js":11}],3:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){n(this,t),this.trombone=e,this.blockLength=512,this.blockTime=1,this.soundOn=!1,this.useWhiteNoise=!0}return s(t,[{key:"init",value:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new window.AudioContext,this.trombone.sampleRate=this.audioContext.sampleRate,this.blockTime=this.blockLength/this.trombone.sampleRate}},{key:"startSound",value:function(){this.scriptProcessor=this.audioContext.createScriptProcessor(this.blockLength,2,1),this.scriptProcessor.connect(this.audioContext.destination),this.scriptProcessor.onaudioprocess=this.doScriptProcessor.bind(this);var t=this.createWhiteNoiseNode(2*this.trombone.sampleRate),e=this.audioContext.createBiquadFilter();e.type="bandpass",e.frequency.value=500,e.Q.value=.5,t.connect(e),e.connect(this.scriptProcessor);var i=this.audioContext.createBiquadFilter();i.type="bandpass",i.frequency.value=1e3,i.Q.value=.5,t.connect(i),i.connect(this.scriptProcessor),t.start(0)}},{key:"createWhiteNoiseNode",value:function(t){for(var e=this.audioContext.createBuffer(1,t,this.trombone.sampleRate),i=e.getChannelData(0),n=0;n<t;n++)i[n]=this.useWhiteNoise?Math.random():1;var s=this.audioContext.createBufferSource();return s.buffer=e,s.loop=!0,s}},{key:"doScriptProcessor",value:function(t){for(var e=t.inputBuffer.getChannelData(0),i=t.inputBuffer.getChannelData(1),n=t.outputBuffer.getChannelData(0),s=0,o=n.length;s<o;s++){var r=s/o,a=(s+.5)/o,h=this.trombone.Glottis.runStep(r,e[s]),u=0;this.trombone.Tract.runStep(h,i[s],r),u+=this.trombone.Tract.lipOutput+this.trombone.Tract.noseOutput,this.trombone.Tract.runStep(h,i[s],a),u+=this.trombone.Tract.lipOutput+this.trombone.Tract.noseOutput,n[s]=.125*u}this.trombone.Glottis.finishBlock(),this.trombone.Tract.finishBlock()}},{key:"mute",value:function(){this.scriptProcessor.disconnect()}},{key:"unmute",value:function(){this.scriptProcessor.connect(this.audioContext.destination)}}]),t}();i.AudioSystem=o},{}],4:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Glottis=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=t("../noise.js"),r=function(t){return t&&t.__esModule?t:{default:t}}(o),a=function(){function t(e){n(this,t),this.trombone=e,this.timeInWaveform=0,this.oldFrequency=140,this.newFrequency=140,this.UIFrequency=140,this.smoothFrequency=140,this.oldTenseness=.6,this.newTenseness=.6,this.UITenseness=.6,this.totalTime=0,this.vibratoAmount=.005,this.vibratoFrequency=6,this.intensity=0,this.loudness=1,this.isTouched=!1,this.touch=0,this.x=240,this.y=530,this.keyboardTop=500,this.keyboardLeft=0,this.keyboardWidth=600,this.keyboardHeight=100,this.semitones=20,this.marks=[0,0,0,1,0,0,0,0,1,0,1,0,0,0,0],this.baseNote=87.3071,this.output}return s(t,[{key:"init",value:function(){this.setupWaveform(0)}},{key:"handleTouches",value:function(){if(0==this.touch||this.touch.alive||(this.touch=0),0==this.touch)for(var e=0;e<UI.touchesWithMouse.length;e++){var i=UI.touchesWithMouse[e];i.alive&&(i.y<this.keyboardTop||(this.touch=i))}if(0!=this.touch){var n=this.touch.y-this.keyboardTop-10,s=this.touch.x-this.keyboardLeft;n=Math.clamp(n,0,this.keyboardHeight-26);var o=this.semitones*s/this.keyboardWidth+.5;t.UIFrequency=this.baseNote*Math.pow(2,o/12),0==t.intensity&&(t.smoothFrequency=t.UIFrequency);var r=Math.clamp(1-n/(this.keyboardHeight-28),0,1);t.UITenseness=1-Math.cos(r*Math.PI*.5),t.loudness=Math.pow(t.UITenseness,.25),this.x=this.touch.x,this.y=n+this.keyboardTop+10}t.isTouched=0!=this.touch}},{key:"runStep",value:function(t,e){var i=1/this.trombone.sampleRate;this.timeInWaveform+=i,this.totalTime+=i,this.timeInWaveform>this.waveformLength&&(this.timeInWaveform-=this.waveformLength,this.setupWaveform(t));var n=this.normalizedLFWaveform(this.timeInWaveform/this.waveformLength),s=this.intensity*(1-Math.sqrt(this.UITenseness))*this.getNoiseModulator()*e;return s*=.2+.02*r.default.simplex1(1.99*this.totalTime),n+=s}},{key:"getNoiseModulator",value:function(){var t=.1+.2*Math.max(0,Math.sin(2*Math.PI*this.timeInWaveform/this.waveformLength));return this.UITenseness*this.intensity*t+.3*(1-this.UITenseness*this.intensity)}},{key:"finishBlock",value:function(){var t=0;t+=this.vibratoAmount*Math.sin(2*Math.PI*this.totalTime*this.vibratoFrequency),t+=.02*r.default.simplex1(4.07*this.totalTime),t+=.04*r.default.simplex1(2.15*this.totalTime),this.trombone.autoWobble&&(t+=.2*r.default.simplex1(.98*this.totalTime),t+=.4*r.default.simplex1(.5*this.totalTime)),this.UIFrequency>this.smoothFrequency&&(this.smoothFrequency=Math.min(1.1*this.smoothFrequency,this.UIFrequency)),this.UIFrequency<this.smoothFrequency&&(this.smoothFrequency=Math.max(this.smoothFrequency/1.1,this.UIFrequency)),this.oldFrequency=this.newFrequency,this.newFrequency=this.smoothFrequency*(1+t),this.oldTenseness=this.newTenseness,this.newTenseness=this.UITenseness+.1*r.default.simplex1(.46*this.totalTime)+.05*r.default.simplex1(.36*this.totalTime),!this.isTouched&&this.trombone.alwaysVoice&&(this.newTenseness+=(3-this.UITenseness)*(1-this.intensity)),(this.isTouched||this.trombone.alwaysVoice)&&(this.intensity+=.13),this.intensity=Math.clamp(this.intensity,0,1)}},{key:"setupWaveform",value:function(t){this.frequency=this.oldFrequency*(1-t)+this.newFrequency*t;var e=this.oldTenseness*(1-t)+this.newTenseness*t;this.Rd=3*(1-e),this.waveformLength=1/this.frequency;var i=this.Rd;i<.5&&(i=.5),i>2.7&&(i=2.7);var n=.048*i-.01,s=.224+.118*i,o=s/4*(.5+1.2*s)/(.11*i-n*(.5+1.2*s)),r=n,a=1/(2*o),h=a+a*s,u=1/r,l=Math.exp(-u*(1-h)),c=1-l,f=1/u*(l-1)+(1-h)*l;f/=c;var d=-(h-a)/2+f,m=-d,p=Math.PI/a,v=Math.sin(p*h),y=-Math.PI*v*m/(2*a),b=Math.log(y),w=b/(a/2-h),g=-1/(v*Math.exp(w*h));this.alpha=w,this.E0=g,this.epsilon=u,this.shift=l,this.Delta=c,this.Te=h,this.omega=p}},{key:"normalizedLFWaveform",value:function(t){return t>this.Te?this.output=(-Math.exp(-this.epsilon*(t-this.Te))+this.shift)/this.Delta:this.output=this.E0*Math.exp(this.alpha*t)*Math.sin(this.omega*t),this.output*this.intensity*this.loudness}}]),t}();i.Glottis=a},{"../noise.js":8}],5:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){n(this,t),this.trombone=e,this.originX=340,this.originY=449,this.radius=298,this.scale=60,this.tongueIndex=12.9,this.tongueDiameter=2.43,this.innerTongueControlRadius=2.05,this.outerTongueControlRadius=3.5,this.tongueTouch=0,this.angleScale=.64,this.angleOffset=-.24,this.noseOffset=.8,this.gridOffset=1.7,this.target=.1,this.index=42,this.radius=0}return s(t,[{key:"init",value:function(){var t=this.trombone.Tract;this.setRestDiameter();for(var e=0;e<t.n;e++)t.diameter[e]=t.targetDiameter[e]=t.restDiameter[e];this.tongueLowerIndexBound=t.bladeStart+2,this.tongueUpperIndexBound=t.tipStart-3,this.tongueIndexCentre=.5*(this.tongueLowerIndexBound+this.tongueUpperIndexBound)}},{key:"getIndex",value:function(t,e){for(var i=this.trombone.Tract,n=t-this.originX,s=e-this.originY,o=Math.atan2(s,n);o>0;)o-=2*Math.PI;return(Math.PI+o-this.angleOffset)*(i.lipStart-1)/(this.angleScale*Math.PI)}},{key:"getDiameter",value:function(t,e){var i=t-this.originX,n=e-this.originY;return(this.radius-Math.sqrt(i*i+n*n))/this.scale}},{key:"setRestDiameter",value:function(){for(var t=this.trombone.Tract,e=t.bladeStart;e<t.lipStart;e++){var i=1.1*Math.PI*(this.tongueIndex-e)/(t.tipStart-t.bladeStart),n=2+(this.tongueDiameter-2)/1.5,s=(1.5-n+this.gridOffset)*Math.cos(i);e!=t.bladeStart-2&&e!=t.lipStart-1||(s*=.8),e!=t.bladeStart&&e!=t.lipStart-2||(s*=.94),t.restDiameter[e]=1.5-s}}},{key:"Buh",value:function(t){var e=this.trombone.Tract;this.setRestDiameter();for(var i=0;i<e.n;i++)e.targetDiameter[i]=e.restDiameter[i];for(var n=this.index-this.radius;n<=this.index+this.radius;n++)if(!(n>e.targetDiameter.length||n<0)){var s=Math.lerp(e.restDiameter[n],this.target,t);e.targetDiameter[n]=s}}}]),t}();i.TractUI=o},{}],6:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e){n(this,t),this.trombone=e,this.n=44,this.bladeStart=10,this.tipStart=32,this.lipStart=39,this.R=[],this.L=[],this.reflection=[],this.junctionOutputR=[],this.junctionOutputL=[],this.maxAmplitude=[],this.diameter=[],this.restDiameter=[],this.targetDiameter=[],this.newDiameter=[],this.A=[],this.glottalReflection=.75,this.lipReflection=-.85,this.lastObstruction=-1,this.fade=1,this.movementSpeed=15,this.transients=[],this.lipOutput=0,this.noseOutput=0,this.velumTarget=.01}return s(t,[{key:"init",value:function(){this.bladeStart=Math.floor(this.bladeStart*this.n/44),this.tipStart=Math.floor(this.tipStart*this.n/44),this.lipStart=Math.floor(this.lipStart*this.n/44),this.diameter=new Float64Array(this.n),this.restDiameter=new Float64Array(this.n),this.targetDiameter=new Float64Array(this.n),this.newDiameter=new Float64Array(this.n);for(var t=0;t<this.n;t++){var e=0;e=t<7*this.n/44-.5?.6:t<12*this.n/44?1.1:1.5,this.diameter[t]=this.restDiameter[t]=this.targetDiameter[t]=this.newDiameter[t]=e}this.R=new Float64Array(this.n),this.L=new Float64Array(this.n),this.reflection=new Float64Array(this.n+1),this.newReflection=new Float64Array(this.n+1),this.junctionOutputR=new Float64Array(this.n+1),this.junctionOutputL=new Float64Array(this.n+1),this.A=new Float64Array(this.n),this.maxAmplitude=new Float64Array(this.n),this.noseLength=Math.floor(28*this.n/44),this.noseStart=this.n-this.noseLength+1,this.noseR=new Float64Array(this.noseLength),this.noseL=new Float64Array(this.noseLength),this.noseJunctionOutputR=new Float64Array(this.noseLength+1),this.noseJunctionOutputL=new Float64Array(this.noseLength+1),this.noseReflection=new Float64Array(this.noseLength+1),this.noseDiameter=new Float64Array(this.noseLength),this.noseA=new Float64Array(this.noseLength),this.noseMaxAmplitude=new Float64Array(this.noseLength);for(var t=0;t<this.noseLength;t++){var e,i=t/this.noseLength*2;e=i<1?.4+1.6*i:.5+1.5*(2-i),e=Math.min(e,1.9),this.noseDiameter[t]=e}this.newReflectionLeft=this.newReflectionRight=this.newReflectionNose=0,this.calculateReflections(),this.calculateNoseReflections(),this.noseDiameter[0]=this.velumTarget}},{key:"reshapeTract",value:function(t){for(var e=t*this.movementSpeed,i=-1,n=0;n<this.n;n++){var s=this.diameter[n],o=this.targetDiameter[n];s<=0&&(i=n);var r;r=n<this.noseStart?.6:n>=this.tipStart?1:.6+.4*(n-this.noseStart)/(this.tipStart-this.noseStart),this.diameter[n]=Math.moveTowards(s,o,r*e,2*e)}this.lastObstruction>-1&&-1==i&&this.noseA[0]<.05&&this.addTransient(this.lastObstruction),this.lastObstruction=i,e=t*this.movementSpeed,this.noseDiameter[0]=Math.moveTowards(this.noseDiameter[0],this.velumTarget,.25*e,.1*e),this.noseA[0]=this.noseDiameter[0]*this.noseDiameter[0]}},{key:"calculateReflections",value:function(){for(var t=0;t<this.n;t++)this.A[t]=this.diameter[t]*this.diameter[t];for(var t=1;t<this.n;t++)this.reflection[t]=this.newReflection[t],0==this.A[t]?this.newReflection[t]=.999:this.newReflection[t]=(this.A[t-1]-this.A[t])/(this.A[t-1]+this.A[t]);this.reflectionLeft=this.newReflectionLeft,this.reflectionRight=this.newReflectionRight,this.reflectionNose=this.newReflectionNose;var e=this.A[this.noseStart]+this.A[this.noseStart+1]+this.noseA[0];this.newReflectionLeft=(2*this.A[this.noseStart]-e)/e,this.newReflectionRight=(2*this.A[this.noseStart+1]-e)/e,this.newReflectionNose=(2*this.noseA[0]-e)/e}},{key:"calculateNoseReflections",value:function(){for(var t=0;t<this.noseLength;t++)this.noseA[t]=this.noseDiameter[t]*this.noseDiameter[t];for(var t=1;t<this.noseLength;t++)this.noseReflection[t]=(this.noseA[t-1]-this.noseA[t])/(this.noseA[t-1]+this.noseA[t])}},{key:"runStep",value:function(t,e,i){var n=Math.random()<.1;this.processTransients(),this.addTurbulenceNoise(e),this.junctionOutputR[0]=this.L[0]*this.glottalReflection+t,this.junctionOutputL[this.n]=this.R[this.n-1]*this.lipReflection;for(var s=1;s<this.n;s++){var o=this.reflection[s]*(1-i)+this.newReflection[s]*i,r=o*(this.R[s-1]+this.L[s]);this.junctionOutputR[s]=this.R[s-1]-r,this.junctionOutputL[s]=this.L[s]+r}var s=this.noseStart,o=this.newReflectionLeft*(1-i)+this.reflectionLeft*i;this.junctionOutputL[s]=o*this.R[s-1]+(1+o)*(this.noseL[0]+this.L[s]),o=this.newReflectionRight*(1-i)+this.reflectionRight*i,this.junctionOutputR[s]=o*this.L[s]+(1+o)*(this.R[s-1]+this.noseL[0]),o=this.newReflectionNose*(1-i)+this.reflectionNose*i,this.noseJunctionOutputR[0]=o*this.noseL[0]+(1+o)*(this.L[s]+this.R[s-1]);for(var s=0;s<this.n;s++)if(this.R[s]=.999*this.junctionOutputR[s],this.L[s]=.999*this.junctionOutputL[s+1],n){var a=Math.abs(this.R[s]+this.L[s]);a>this.maxAmplitude[s]?this.maxAmplitude[s]=a:this.maxAmplitude[s]*=.999}this.lipOutput=this.R[this.n-1],this.noseJunctionOutputL[this.noseLength]=this.noseR[this.noseLength-1]*this.lipReflection;for(var s=1;s<this.noseLength;s++){var r=this.noseReflection[s]*(this.noseR[s-1]+this.noseL[s]);this.noseJunctionOutputR[s]=this.noseR[s-1]-r,this.noseJunctionOutputL[s]=this.noseL[s]+r}for(var s=0;s<this.noseLength;s++)if(this.noseR[s]=this.noseJunctionOutputR[s]*this.fade,this.noseL[s]=this.noseJunctionOutputL[s+1]*this.fade,n){var a=Math.abs(this.noseR[s]+this.noseL[s]);a>this.noseMaxAmplitude[s]?this.noseMaxAmplitude[s]=a:this.noseMaxAmplitude[s]*=.999}this.noseOutput=this.noseR[this.noseLength-1]}},{key:"finishBlock",value:function(){this.reshapeTract(this.trombone.AudioSystem.blockTime),this.calculateReflections()}},{key:"addTransient",value:function(t){var e={};e.position=t,e.timeAlive=0,e.lifeTime=.2,e.strength=.3,e.exponent=200,this.transients.push(e)}},{key:"processTransients",value:function(){for(var t=0;t<this.transients.length;t++){var e=this.transients[t],i=e.strength*Math.pow(2,-e.exponent*e.timeAlive);this.R[e.position]+=i/2,this.L[e.position]+=i/2,e.timeAlive+=1/(2*this.trombone.sampleRate)}for(var t=this.transients.length-1;t>=0;t--){var e=this.transients[t];e.timeAlive>e.lifeTime&&this.transients.splice(t,1)}}},{key:"addTurbulenceNoise",value:function(t){}},{key:"addTurbulenceNoiseAtIndex",value:function(t,e,i){var n=Math.floor(e),s=e-n;t*=this.trombone.Glottis.getNoiseModulator();var o=Math.clamp(8*(.7-i),0,1),r=Math.clamp(30*(i-.3),0,1),a=t*(1-s)*o*r,h=t*s*o*r;this.R[n+1]+=a/2,this.L[n+1]+=a/2,this.R[n+2]+=h/2,this.L[n+2]+=h/2}}]),t}();i.Tract=o},{}],7:[function(t,e,i){"use strict";Math.clamp=function(t,e,i){return t<e?e:t>i?i:t},Math.moveTowards=function(t,e,i){return t<e?Math.min(t+i,e):Math.max(t-i,e)},Math.moveTowards=function(t,e,i,n){return t<e?Math.min(t+i,e):Math.max(t-n,e)},Math.gaussian=function(){for(var t=0,e=0;e<16;e++)t+=Math.random();return(t-8)/4},Math.lerp=function(t,e,i){return t+(e-t)*i}},{}],8:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(e,i,s){n(this,t),this.x=e,this.y=i,this.z=s}return s(t,[{key:"dot2",value:function(t,e){return this.x*t+this.y*e}},{key:"dot3",value:function(t,e,i){return this.x*t+this.y*e+this.z*i}}]),t}(),r=function(){function t(){n(this,t),this.grad3=[new o(1,1,0),new o(-1,1,0),new o(1,-1,0),new o(-1,-1,0),new o(1,0,1),new o(-1,0,1),new o(1,0,-1),new o(-1,0,-1),new o(0,1,1),new o(0,-1,1),new o(0,1,-1),new o(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(Date.now())}return s(t,[{key:"seed",value:function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var i;i=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=i,this.gradP[e]=this.gradP[e+256]=this.grad3[i%12]}}},{key:"simplex2",value:function(t,e){var i,n,s,o,r,a=.5*(Math.sqrt(3)-1),h=(3-Math.sqrt(3))/6,u=(t+e)*a,l=Math.floor(t+u),c=Math.floor(e+u),f=(l+c)*h,d=t-l+f,m=e-c+f;d>m?(o=1,r=0):(o=0,r=1);var p=d-o+h,v=m-r+h,y=d-1+2*h,b=m-1+2*h;l&=255,c&=255;var w=this.gradP[l+this.perm[c]],g=this.gradP[l+o+this.perm[c+r]],T=this.gradP[l+1+this.perm[c+1]],M=.5-d*d-m*m;M<0?i=0:(M*=M,i=M*M*w.dot2(d,m));var R=.5-p*p-v*v;R<0?n=0:(R*=R,n=R*R*g.dot2(p,v));var L=.5-y*y-b*b;return L<0?s=0:(L*=L,s=L*L*T.dot2(y,b)),70*(i+n+s)}},{key:"simplex1",value:function(t){return this.simplex2(1.2*t,.7*-t)}}]),t}(),a=new r;Object.freeze(a),i.default=a},{}],9:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.PinkTrombone=void 0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();t("./math-extensions.js");var o=t("./components/audio-system.js"),r=t("./components/glottis.js"),a=t("./components/tract.js"),h=t("./components/tract-ui.js"),u=function(){function t(){n(this,t),this.sampleRate=0,this.time=0,this.alwaysVoice=!0,this.autoWobble=!0,this.noiseFreq=500,this.noiseQ=.7,this.AudioSystem=new o.AudioSystem(this),this.AudioSystem.init(),this.Glottis=new r.Glottis(this),this.Glottis.init(),this.Tract=new a.Tract(this),this.Tract.init(),this.TractUI=new h.TractUI(this),this.TractUI.init()}return s(t,[{key:"StartAudio",value:function(){this.muted=!1,this.AudioSystem.startSound()}},{key:"SetMute",value:function(t){t?this.AudioSystem.mute():this.AudioSystem.unmute(),this.muted=t}},{key:"ToggleMute",value:function(){this.SetMute(!this.muted)}}]),t}();i.PinkTrombone=u},{"./components/audio-system.js":3,"./components/glottis.js":4,"./components/tract-ui.js":5,"./components/tract.js":6,"./math-extensions.js":7}],10:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){n(this,t)}return s(t,null,[{key:"LoadOBJ",value:function(t,e){var i=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},n=function(t){},s=new THREE.MTLLoader;s.setPath(t.path),s.load(t.mtlFile,function(s){s.preload();var o=new THREE.OBJLoader;o.setMaterials(s),o.setPath(t.path),o.load(t.objFile,function(t){e(t)},i,n)})}},{key:"LoadJSON",value:function(t,e){var i=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},n=function(t){};(new THREE.JSONLoader).load(t,function(t,i){var n=!0,s=!1,o=void 0;try{for(var r,a=i[Symbol.iterator]();!(n=(r=a.next()).done);n=!0)r.value.skinning=!0}catch(t){s=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(s)throw o}}var h=new THREE.SkinnedMesh(t,new THREE.MultiMaterial(i));h.name="Jon",e(h)},i,n)}},{key:"LoadFBX",value:function(t,e){var i=new THREE.LoadingManager;i.onProgress=function(t,e,i){console.log(t,e,i)};var n=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;console.log(Math.round(e,2)+"% downloaded")}},s=function(t){};new THREE.FBXLoader(i).load(t,function(t){e(t)},n,s)}}]),t}();i.ModelLoader=o},{}],11:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){n(this,t)}return s(t,null,[{key:"HasWebGL",value:function(){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),e=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<4;n++)try{if((i=t.getContext(e[n]))&&"function"==typeof i.getParameter)return!0}catch(t){}return!1}return!1}},{key:"GetErrorHTML",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null==t&&(t='Your graphics card does not seem to support \n                        <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>. <br>\n                        Find out how to get it <a href="http://get.webgl.org/">here</a>.'),'\n        <div class="no-webgl-support">\n        <p style="text-align: center;">'+t+"</p>\n        </div>\n        "}}]),t}();i.Detector=o},{}]},{},[2]);
//# sourceMappingURL=jon-trombone.min.js.map
